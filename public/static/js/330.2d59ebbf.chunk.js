/*! For license information please see 330.2d59ebbf.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkmrvl_frontend=self.webpackChunkmrvl_frontend||[]).push([[330],{631:(e,t,a)=>{a.d(t,{GF:()=>r,Ni:()=>o,rQ:()=>n});const s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"top-right";document.querySelectorAll(".mrvl-toast").forEach((e=>{document.body.contains(e)&&document.body.removeChild(e)}));const r=document.createElement("div"),o={"top-right":"top-4 right-4","top-left":"top-4 left-4","top-center":"top-4 left-1/2 transform -translate-x-1/2","bottom-right":"bottom-4 right-4","bottom-left":"bottom-4 left-4","bottom-center":"bottom-4 left-1/2 transform -translate-x-1/2"},n={success:"bg-green-500 text-white border-green-600",error:"bg-red-500 text-white border-red-600",warning:"bg-yellow-500 text-white border-yellow-600",info:"bg-blue-500 text-white border-blue-600",achievement:"bg-gradient-to-r from-yellow-500 to-orange-500 text-white border-orange-600"},l={success:"\u2705",error:"\u274c",warning:"\u26a0\ufe0f",info:"\u2139\ufe0f",achievement:"\ud83c\udfc6"},i=o[s]||o["top-right"],d=n[t]||n.info,c=l[t]||l.info;return r.className="mrvl-toast fixed ".concat(i," z-[9999] px-4 py-3 rounded-lg shadow-lg border-l-4 ").concat(d," font-medium max-w-sm transform transition-all duration-300 ease-in-out translate-x-full opacity-0"),r.innerHTML='\n    <div class="flex items-center space-x-2">\n      <span class="text-lg">'.concat(c,'</span>\n      <span class="flex-1">').concat(e,'</span>\n      <button class="ml-2 text-white/80 hover:text-white transition-colors" onclick="this.parentElement.parentElement.remove()">\n        \xd7\n      </button>\n    </div>\n  '),document.body.appendChild(r),requestAnimationFrame((()=>{r.classList.remove("translate-x-full","opacity-0"),r.classList.add("translate-x-0","opacity-100")})),setTimeout((()=>{document.body.contains(r)&&(r.classList.add("translate-x-full","opacity-0"),setTimeout((()=>{document.body.contains(r)&&document.body.removeChild(r)}),300))}),a),r},r=function(e){return s(e,"success",arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3)},o=function(e){return s(e,"error",arguments.length>1&&void 0!==arguments[1]?arguments[1]:4e3)},n=function(e){return s(e,"warning",arguments.length>1&&void 0!==arguments[1]?arguments[1]:3500)}},1449:(e,t,a)=>{a.d(t,{A:()=>s});const s=(0,a(6230).A)("message-circle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]])},3330:(e,t,a)=>{a.r(t),a.d(t,{default:()=>w});var s=a(2555),r=a(9950),o=a(5150),n=a(6225),l=a(1453),i=(a(8574),a(3219)),d=a(5621),c=a(1990),m=a(4414);var u=a(8067),x=a(4085),v=a(1368),h=a(6230);const p=(0,h.A)("reply",[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]]),g=(0,h.A)("pen-line",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);var y=a(4814),b=a(1449);const f=e=>{let{matchId:t,navigateTo:a}=e;const{isAuthenticated:n,isAdmin:i,isModerator:d,api:h,user:f}=(0,o.As)(),[k,j]=(0,r.useState)([]),[_,w]=(0,r.useState)(!0),[N,A]=(0,r.useState)(""),[S,C]=(0,r.useState)(null),[M,D]=(0,r.useState)(!1),[E,T]=(0,r.useState)(null),[P,F]=(0,r.useState)(""),[L,B]=(0,r.useState)(1),[V,z]=(0,r.useState)(!1),[U,O]=(0,r.useState)(0),[I,R]=(0,r.useState)(null),H=e=>"string"===typeof e?e:null===e||void 0===e?"":"object"===typeof e?e.message?e.message:e.error&&"string"===typeof e.error?e.error:e.content?String(e.content):"":String(e),W=(0,r.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{w(!0);const a=(new Date).getTime(),s=await h.get("/matches/".concat(t,"/comments?page=").concat(e,"&per_page=20&t=").concat(a),{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}}),r=s.data||s,o=r.data||[],n=r.meta||{};j(1===e?o:e=>[...e,...o]),z(n.has_more_pages||!1),O(n.total||o.length),B(e),R(n.match||null)}catch(a){console.error("\u274c MatchComments: Failed to load comments:",a),1===e&&j([])}finally{w(!1)}}),[h,t]);(0,r.useEffect)((()=>{W()}),[W]);const q=e=>{if(!e)return"Unknown";const t=new Date(e);if(isNaN(t.getTime()))return"Unknown";const a=new Date,s=Math.floor((a-t)/36e5);if(s<1)return"Just now";if(s<24)return"".concat(s,"h");if(s<48)return"Yesterday";const r=Math.floor(s/24);if(r<30)return"".concat(r,"d");const o=Math.floor(r/30);if(o<12)return"".concat(o,"mo");const n=Math.floor(o/12);return"".concat(n,"y")},Y=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const r=H(e);if(!r||"string"!==typeof r)return null;const o={};Array.isArray(t)&&t.forEach((e=>{if("object"===typeof e&&null!==e){const t=H(e.mention_text);t&&(o[t]=(0,s.A)((0,s.A)({},e),{},{type:H(e.type)||"user",id:e.id||"",name:H(e.name)||"",display_name:H(e.display_name)||H(e.name)||"",username:H(e.username)||"",team_name:H(e.team_name)||"",player_name:H(e.player_name)||""}))}}));const n=/(@[a-zA-Z0-9_]+|@team:[a-zA-Z0-9_]+|@player:[a-zA-Z0-9_]+)/g;return r.split(n).map(((e,t)=>{const s=o[e];return s&&s.id?(0,m.jsx)(v.A,{mention:s,navigateTo:a,onClick:e=>{const t={player:()=>a("player-detail",{id:e.id}),team:()=>a("team-detail",{id:e.id}),user:()=>a("user-profile",{id:e.id})};t[e.type]&&t[e.type]()}},t):e.match(n)?(0,m.jsx)("span",{className:"inline-flex items-center font-medium text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 cursor-pointer",title:"Mention",children:e},t):e}))},G=async e=>{e.preventDefault();const a=H(N);if(!a.trim()||M)return;if(null!==S&&void 0!==S&&S.id&&S.id.toString().startsWith("temp-"))return void alert("Please wait for the comment to be created before replying to it.");const r=[...k];try{var o;D(!0);const e={id:"temp-".concat(Date.now()),content:H(a.trim()),author:(0,s.A)((0,s.A)({},f),{},{name:H(null===f||void 0===f?void 0:f.name),username:H(null===f||void 0===f?void 0:f.username),email:H(null===f||void 0===f?void 0:f.email),id:(null===f||void 0===f?void 0:f.id)||null,avatar_url:H(null===f||void 0===f?void 0:f.avatar_url)}),meta:{created_at:(new Date).toISOString()},is_temp:!0,upvotes:0,downvotes:0,user_vote:null,mentions:[],stats:{upvotes:0,downvotes:0},replies:[]};j(S?t=>t.map((t=>t.id===S.id?(0,s.A)((0,s.A)({},t),{},{replies:[...t.replies||[],e]}):t)):t=>[...t,e]);const c={content:H(a.trim()),parent_id:(null===S||void 0===S?void 0:S.id)||null},v=await h.post("/matches/".concat(t,"/comments"),c);if(201===v.status||!0===(null===(o=v.data)||void 0===o?void 0:o.success)||v.data&&!v.data.error&&v.data.comment){A(""),C(null);const t=v.data.comment||v.data.data||v.data;if(t&&(H(t.content)||t.id)){var n,l,i,d,m;const a=(0,s.A)((0,s.A)({},t),{},{content:H(t.content),author:(0,s.A)((0,s.A)({},t.author),{},{name:H(null===(n=t.author)||void 0===n?void 0:n.name),username:H(null===(l=t.author)||void 0===l?void 0:l.username),id:(null===(i=t.author)||void 0===i?void 0:i.id)||null,email:H(null===(d=t.author)||void 0===d?void 0:d.email),avatar_url:H(null===(m=t.author)||void 0===m?void 0:m.avatar_url)}),mentions:Array.isArray(t.mentions)?t.mentions.map((e=>"object"===typeof e&&null!==e?(0,s.A)((0,s.A)({},e),{},{mention_text:H(e.mention_text),name:H(e.name),display_name:H(e.display_name),type:H(e.type),id:e.id||null,username:H(e.username),team_name:H(e.team_name),player_name:H(e.player_name)}):{mention_text:H(e),name:H(e),display_name:H(e),type:"user",id:null})):[],meta:t.meta||{},stats:t.stats||{},upvotes:t.upvotes||0,downvotes:t.downvotes||0,user_vote:t.user_vote||null,replies:Array.isArray(t.replies)?t.replies:[]});j(S?t=>t.map((t=>t.id===S.id?(0,s.A)((0,s.A)({},t),{},{replies:t.replies.map((t=>t.id===e.id?a:t))}):t)):t=>t.map((t=>t.id===e.id?a:t))),O((e=>e+1))}else await W(1);const a=document.createElement("div");a.textContent="\u2705 Comment posted successfully",a.className="fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded shadow-lg z-50",document.body.appendChild(a),setTimeout((()=>document.body.removeChild(a)),3e3)}else{var u,x;j(r),console.error("\u274c Comment submission failed:",v.data);const e=(null===(u=v.data)||void 0===u?void 0:u.message)||(null===(x=v.data)||void 0===x?void 0:x.error)||"Failed to submit comment. Please try again.";alert(e)}}catch(g){var v,p;console.error("\u274c Failed to submit comment:",g),j(r);let e="Failed to submit comment. Please try again.";const t=(0,c.Jo)(g);t.includes("401")||401===(null===(v=g.response)||void 0===v?void 0:v.status)?e="Please log in again to post comments.":t.includes("403")||403===(null===(p=g.response)||void 0===p?void 0:p.status)?e="You do not have permission to comment on this match.":"An unknown error occurred"!==t&&(e=t),alert(e)}finally{D(!1)}},K=function(e){var t,a,r,o,v,b,_;let w=arguments.length>1&&void 0!==arguments[1]&&arguments[1],L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const B=e.replies&&e.replies.length>0&&L<3,V=w?{marginLeft:"".concat(Math.min(2*L,6),"rem")}:{};return(0,m.jsx)("div",{className:"".concat(w?"pl-4 border-l-2 border-gray-200 dark:border-gray-700":""," py-4 ").concat(L>0?"bg-gray-50/50 dark:bg-gray-800/50 rounded-lg":""),style:V,children:(0,m.jsxs)("div",{className:"w-full",children:[(0,m.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,m.jsx)(l.A,{user:e.author,showAvatar:!0,showHeroFlair:!0,showTeamFlair:!0,size:"sm",clickable:!1}),(0,m.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-500",children:q((null===(t=e.meta)||void 0===t?void 0:t.created_at)||e.created_at)}),e.is_temp&&(0,m.jsxs)("span",{className:"text-xs text-blue-500 dark:text-blue-400 flex items-center",children:[(0,m.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse mr-1"}),"Posting..."]}),e.is_edited&&!e.is_temp&&(0,m.jsxs)("span",{className:"text-xs text-gray-400 dark:text-gray-600",children:["(edited ",q((null===(a=e.meta)||void 0===a?void 0:a.updated_at)||e.edited_at),")"]}),!e.is_temp&&(0,m.jsx)(u.A,{itemType:"match-comment",itemId:e.id,initialUpvotes:(null===(r=e.stats)||void 0===r?void 0:r.upvotes)||e.upvotes||0,initialDownvotes:(null===(o=e.stats)||void 0===o?void 0:o.downvotes)||e.downvotes||0,userVote:e.user_vote,direction:"horizontal",size:"xs",onVoteChange:t=>{j((a=>a.map((a=>{var r,o,n,l,i,d;return a.id===e.id?(0,s.A)((0,s.A)({},a),{},{stats:(0,s.A)((0,s.A)({},a.stats),{},{upvotes:(null===(r=t.vote_counts)||void 0===r?void 0:r.upvotes)||(null===(o=a.stats)||void 0===o?void 0:o.upvotes)||0,downvotes:(null===(n=t.vote_counts)||void 0===n?void 0:n.downvotes)||(null===(l=a.stats)||void 0===l?void 0:l.downvotes)||0}),upvotes:(null===(i=t.vote_counts)||void 0===i?void 0:i.upvotes)||a.upvotes||0,downvotes:(null===(d=t.vote_counts)||void 0===d?void 0:d.downvotes)||a.downvotes||0,user_vote:t.user_vote}):a}))))}})]}),(0,m.jsx)("div",{className:"prose prose-sm dark:prose-invert max-w-none mb-4",children:(0,c.Vm)(e.content).split("\n").map(((t,a)=>(0,m.jsx)("p",{className:"mb-2 last:mb-0",children:Y(H(t),e.mentions||[])},a)))}),(0,m.jsxs)("div",{className:"flex items-center space-x-4 mb-3",children:[n&&!e.is_temp&&(0,m.jsxs)("button",{onClick:()=>C(e),className:"text-xs text-gray-500 dark:text-gray-500 hover:text-red-600 dark:hover:text-red-400 transition-colors flex items-center gap-1",children:[(0,m.jsx)(p,{className:"w-3 h-3"}),"Reply"]}),((null===(v=e.author)||void 0===v?void 0:v.id)===(null===f||void 0===f?void 0:f.id)||i()||d())&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("button",{onClick:()=>(e=>{T(e),F(e.content)})(e),className:"text-xs text-gray-500 dark:text-gray-500 hover:text-red-600 dark:hover:text-red-400 transition-colors flex items-center gap-1",children:[(0,m.jsx)(g,{className:"w-3 h-3"}),"Edit"]}),(0,m.jsxs)("button",{onClick:()=>(async e=>{if(!window.confirm("Are you sure you want to delete this comment?"))return;const t=[...k];try{var a;D(!0);const r=k.map((t=>{if(t.id===e)return null;if(t.replies&&t.replies.length>0){const a=t.replies.filter((t=>t.id!==e));return(0,s.A)((0,s.A)({},t),{},{replies:a})}return t})).filter((e=>null!==e));j(r);const o=await h.delete("/match-comments/".concat(e));if(null!==(a=o.data)&&void 0!==a&&a.success||o.success){console.log("\u2705 Comment deleted successfully"),O((e=>Math.max(0,e-1)));const e=document.createElement("div");e.textContent="\u2705 Comment deleted successfully",e.className="fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded shadow-lg z-50",document.body.appendChild(e),setTimeout((()=>document.body.removeChild(e)),3e3)}else console.warn("\u26a0\ufe0f Delete request did not return success, rolling back"),j(t),alert("Failed to delete comment. Please try again.")}catch(l){var r,o,n;console.error("\u274c Failed to delete comment:",l),j(t);let e="Failed to delete comment. Please try again.";const a=(0,c.Jo)(l);a.includes("403")||403===(null===(r=l.response)||void 0===r?void 0:r.status)?e="You do not have permission to delete this comment.":a.includes("404")||404===(null===(o=l.response)||void 0===o?void 0:o.status)?e="Comment not found or already deleted.":a.includes("401")||401===(null===(n=l.response)||void 0===n?void 0:n.status)?e="Please log in again to delete comments.":"An unknown error occurred"!==a&&(e=a),alert(e)}finally{D(!1)}})(e.id),disabled:M,className:"text-xs transition-colors flex items-center gap-1 ".concat(M?"text-gray-400 dark:text-gray-600 cursor-not-allowed":"text-gray-500 dark:text-gray-500 hover:text-red-600 dark:hover:text-red-400"),children:[(0,m.jsx)(y.A,{className:"w-3 h-3"}),M?"Deleting...":"Delete"]})]})]}),(null===S||void 0===S?void 0:S.id)===e.id&&(0,m.jsx)("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded",children:(0,m.jsxs)("form",{onSubmit:G,children:[(0,m.jsxs)("div",{className:"mb-2",children:[(0,m.jsxs)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Replying to @",(null===(b=e.author)||void 0===b?void 0:b.username)||(null===(_=e.author)||void 0===_?void 0:_.name)]}),(0,m.jsx)("button",{type:"button",onClick:()=>C(null),className:"ml-2 text-xs text-red-600 dark:text-red-400 hover:underline",children:"Cancel"})]}),(0,m.jsx)(x.A,{value:N,onChange:e=>{A(e)},placeholder:"Write your reply... (Type @ to mention teams and players)",rows:3,className:"w-full border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white resize-none focus:ring-2 focus:ring-red-500 dark:focus:ring-red-400 focus:border-transparent"}),(0,m.jsxs)("div",{className:"flex justify-end space-x-2 mt-2",children:[(0,m.jsx)("button",{type:"button",onClick:()=>C(null),className:"px-3 py-1 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors",children:"Cancel"}),(0,m.jsx)("button",{type:"submit",disabled:!H(N).trim()||M,className:"px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:M?"Posting...":"Reply"})]})]})}),(null===E||void 0===E?void 0:E.id)===e.id&&(0,m.jsx)("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded border border-blue-200 dark:border-blue-700",children:(0,m.jsxs)("form",{onSubmit:t=>{t.preventDefault(),(async e=>{const t=H(P);if(t.trim())try{var a;D(!0),null!==(a=(await h.put("/match-comments/".concat(e),{content:t.trim()})).data)&&void 0!==a&&a.success?(T(null),F(""),await W(1)):alert("Failed to edit comment. Please try again.")}catch(s){console.error("\u274c Failed to edit comment:",s),alert("Failed to edit comment. Please try again.")}finally{D(!1)}})(e.id)},children:[(0,m.jsxs)("div",{className:"mb-2",children:[(0,m.jsx)("span",{className:"text-sm text-blue-600 dark:text-blue-400 font-medium",children:"Editing comment"}),(0,m.jsx)("button",{type:"button",onClick:()=>{T(null),F("")},className:"ml-2 text-xs text-red-600 dark:text-red-400 hover:underline",children:"Cancel"})]}),(0,m.jsx)("textarea",{value:P,onChange:e=>{var t;const a="string"===typeof e?e:(null===(t=e.target)||void 0===t?void 0:t.value)||"";F(a)},placeholder:"Edit your comment...",rows:4,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white resize-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent"}),(0,m.jsxs)("div",{className:"flex justify-end space-x-2 mt-2",children:[(0,m.jsx)("button",{type:"button",onClick:()=>{T(null),F("")},className:"px-3 py-1 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors",children:"Cancel"}),(0,m.jsx)("button",{type:"submit",disabled:!H(P).trim()||M,className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:M?"Saving...":"Save Changes"})]})]})}),B&&(0,m.jsx)("div",{className:"mt-4 space-y-2",children:e.replies.map((e=>K(e,!0,L+1)))}),e.replies&&e.replies.length>0&&L>=3&&(0,m.jsx)("div",{className:"mt-3 ml-4",children:(0,m.jsxs)("button",{className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:["View ",e.replies.length," more ",1===e.replies.length?"reply":"replies","..."]})})]})},e.id)};return _&&0===k.length?(0,m.jsx)("div",{className:"card p-6",children:(0,m.jsxs)("div",{className:"text-center py-8",children:[(0,m.jsx)("div",{className:"text-2xl mb-4",children:"\ud83d\udcac"}),(0,m.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading comments..."})]})}):(0,m.jsxs)("div",{className:"space-y-6",children:[(0,m.jsxs)("div",{className:"card p-6",children:[(0,m.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,m.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,m.jsx)(b.A,{className:"w-6 h-6 text-red-600 dark:text-red-400"}),(0,m.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Match Discussion"}),(0,m.jsxs)("span",{className:"px-2 py-1 text-xs font-bold rounded bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300",children:[U," ",1===U?"comment":"comments"]})]}),I&&(0,m.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-500",children:[I.team1," vs ",I.team2]})]}),n&&!S&&(0,m.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[(0,m.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Share Your Thoughts"}),(0,m.jsxs)("form",{onSubmit:G,children:[(0,m.jsx)(x.A,{value:N,onChange:A,placeholder:"What did you think of this match? (Type @ to mention teams and players)",rows:4,className:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white resize-none focus:ring-2 focus:ring-red-500 dark:focus:ring-red-400 focus:border-transparent"}),(0,m.jsxs)("div",{className:"flex justify-between items-center mt-3",children:[(0,m.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-500",children:"Use @ for users, @team: for teams, @player: for players"}),(0,m.jsx)("button",{type:"submit",disabled:!H(N).trim()||M,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:M?"Posting...":"Post Comment"})]})]})]}),!n&&(0,m.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 text-center",children:[(0,m.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Join the Discussion"}),(0,m.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Sign in to share your thoughts on this match."}),(0,m.jsx)("button",{onClick:()=>window.dispatchEvent(new CustomEvent("mrvl-show-auth-modal")),className:"px-6 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"Sign In to Comment"})]})]}),k.length>0&&(0,m.jsx)("div",{className:"space-y-4",children:k.map((e=>(0,m.jsx)("div",{className:"card p-6",children:K(e,!1,0)},e.id)))}),V&&(0,m.jsx)("div",{className:"text-center",children:(0,m.jsx)("button",{onClick:()=>W(L+1),disabled:_,className:"px-6 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-200 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:_?"Loading...":"Load More Comments"})}),!_&&0===k.length&&(0,m.jsxs)("div",{className:"card p-6 text-center",children:[(0,m.jsx)(b.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,m.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No Comments Yet"}),(0,m.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Be the first to share your thoughts on this match!"}),n&&(0,m.jsx)("button",{onClick:()=>{const e=document.querySelector('textarea[placeholder*="What did you think"]');e&&(e.focus(),e.scrollIntoView({behavior:"smooth",block:"center"}))},className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"Write First Comment"})]})]})};var k=a(7674);class j extends r.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("MatchDetail Error:",e,t)}render(){return this.state.hasError?(0,m.jsx)("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:(0,m.jsxs)("div",{className:"bg-gray-800 rounded-lg p-8 max-w-md",children:[(0,m.jsx)("h2",{className:"text-white text-xl mb-4",children:"Error Loading Match"}),(0,m.jsx)("p",{className:"text-gray-300 mb-4",children:"Failed to load match details. Please try refreshing the page."}),(0,m.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Refresh Page"})]})}):this.props.children}}function _(e){var t,a,l,c,u,x,v,h,p,g,y,b,_,w,N,A,S,C,M,D,E,T,P,F,L,B,V,z,U,O,I,R,H,W,q,Y,G,K,J,Z,Q,X,$,ee,te,ae,se,re,oe,ne,le,ie,de,ce,me,ue,xe,ve;let{matchId:he,navigateTo:pe}=e;const[ge,ye]=(0,r.useState)({}),[be,fe]=(0,r.useState)({}),[ke,je]=(0,r.useState)(null),[_e,we]=(0,r.useState)(!0),[Ne,Ae]=(0,r.useState)(0),[Se,Ce]=(0,r.useState)(null),Me=(0,r.useRef)(0);(0,r.useEffect)((()=>{Me.current=Ne}),[Ne]),(0,r.useEffect)((()=>{const e=e=>{e.target.closest(".hero-menu-container")||fe({})};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)}),[]),(0,r.useEffect)((()=>{var e;console.log("MatchDetailPage: Current map changed to index ".concat(Ne)),null!==ke&&void 0!==ke&&null!==(e=ke.maps)&&void 0!==e&&e[Ne]&&console.log("MatchDetailPage: Current map data:",ke.maps[Ne])}),[Ne,null===ke||void 0===ke?void 0:ke.maps]);const[De,Ee]=(0,r.useState)(!1),[Te,Pe]=(0,r.useState)("disconnected"),Fe=(0,r.useRef)(null),{user:Le,isAuthenticated:Be,api:Ve}=(0,o.As)(),ze=(0,r.useCallback)((e=>{if(!e||0===e.length)return{team1Score:0,team2Score:0};let t=0,a=0;return e.forEach((e=>{e&&("completed"===e.status||e.team1_score>0||e.team2_score>0)&&(e.team1_score>e.team2_score?t++:e.team2_score>e.team1_score&&a++)})),{team1Score:t,team2Score:a}}),[]),Ue=(0,r.useCallback)((e=>{console.log("MatchDetailPage: Handling match update:",e),je((t=>t?(0,s.A)((0,s.A)((0,s.A)({},t),e),{},{team1:e.team1||t.team1,team2:e.team2||t.team2,maps:e.maps||t.maps,team1_score:void 0!==e.team1_score?e.team1_score:t.team1_score,team2_score:void 0!==e.team2_score?e.team2_score:t.team2_score,status:e.status||t.status}):t))}),[]),Oe=(0,r.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unknown";const a=e.data||e;a&&(console.log("\ud83d\udd04 Live update received:",{source:t,hasData:!!a.data,hasMaps:!!a.maps}),je((e=>{var t,r;if(!e)return e;const o=(0,s.A)((0,s.A)({},e),{},{team1:a.team1?(0,s.A)((0,s.A)((0,s.A)({},e.team1),a.team1),{},{players:a.team1.players||e.team1.players}):e.team1,team2:a.team2?(0,s.A)((0,s.A)((0,s.A)({},e.team2),a.team2),{},{players:a.team2.players||e.team2.players}):e.team2,team1_score:void 0!==(null===(t=a.data)||void 0===t?void 0:t.team1_score)?a.data.team1_score:void 0!==a.team1_score?a.team1_score:e.team1_score,team2_score:void 0!==(null===(r=a.data)||void 0===r?void 0:r.team2_score)?a.data.team2_score:void 0!==a.team2_score?a.team2_score:e.team2_score,maps:(t=>{const r=(null===(t=a.data)||void 0===t?void 0:t.maps)||a.maps;if(r&&Array.isArray(r))return console.log("\ud83d\uddfa\ufe0f Updating maps from server:",r.length),r.map(((t,a)=>{var r,o,n,l,i,d,c,m,u,x,v;return(0,s.A)((0,s.A)((0,s.A)({},null===(r=e.maps)||void 0===r?void 0:r[a]),t),{},{map_name:t.map_name||(null===(o=e.maps)||void 0===o||null===(n=o[a])||void 0===n?void 0:n.map_name)||"Map ".concat(a+1),team1_composition:t.team1_composition||t.team1_players||(null===(l=e.maps)||void 0===l||null===(i=l[a])||void 0===i?void 0:i.team1_composition)||[],team2_composition:t.team2_composition||t.team2_players||(null===(d=e.maps)||void 0===d||null===(c=d[a])||void 0===c?void 0:c.team2_composition)||[],team1_players:t.team1_players||t.team1_composition||(null===(m=e.maps)||void 0===m||null===(u=m[a])||void 0===u?void 0:u.team1_players)||[],team2_players:t.team2_players||t.team2_composition||(null===(x=e.maps)||void 0===x||null===(v=x[a])||void 0===v?void 0:v.team2_players)||[]})}));if((a.team1_players||a.team2_players||a.team1_composition||a.team2_composition)&&e.maps){const t=[...e.maps],r=a.current_map_number?a.current_map_number-1:Me.current;return console.log("\ud83d\udcca Updating map ".concat(r+1," player compositions")),t[r]&&(t[r]=(0,s.A)((0,s.A)({},t[r]),{},{team1_composition:a.team1_composition||a.team1_players||t[r].team1_composition,team2_composition:a.team2_composition||a.team2_players||t[r].team2_composition,team1_players:a.team1_players||a.team1_composition||t[r].team1_players,team2_players:a.team2_players||a.team2_composition||t[r].team2_players,team1_score:void 0!==a.map_team1_score?a.map_team1_score:t[r].team1_score,team2_score:void 0!==a.map_team2_score?a.map_team2_score:t[r].team2_score})),t}return e.maps})(),status:a.status||e.status,current_map:a.current_map||a.currentMap||a.current_map_number||e.current_map,current_map_number:a.current_map_number||a.current_map||e.current_map_number,updated_at:(new Date).toISOString(),live_update_timestamp:Date.now()});return console.log("\u2705 Match updated with live data"),o})),console.log("Map switch check:",{isMapSwitch:a.isMapSwitch,current_map:a.current_map,current_map_number:a.current_map_number,currentMapIndexRef:Me.current}),!0===a.isMapSwitch&&(a.current_map_number&&a.current_map_number!==Me.current+1?(console.log("\ud83d\uddfa\ufe0f Switching to map ".concat(a.current_map_number)),Ae(a.current_map_number-1)):a.current_map&&a.current_map!==Me.current+1&&(console.log("\ud83d\uddfa\ufe0f Switching to map ".concat(a.current_map)),Ae(a.current_map-1))))}),[]);(0,r.useEffect)((()=>{const e=Ie();if(e&&ke){console.log("\ud83d\udd14 MatchDetailPage subscribing to efficient live updates for match ".concat(e));const t=k.A.subscribe(e,Oe);return Fe.current=t,Pe("connected"),()=>{console.log("\ud83d\udd15 MatchDetailPage unsubscribing from live updates for match ".concat(e)),Fe.current&&(Fe.current(),Fe.current=null),Pe("disconnected")}}}),[null===ke||void 0===ke?void 0:ke.id,Oe]),(0,r.useEffect)((()=>()=>{Fe.current&&(Fe.current(),Fe.current=null)}),[]);const Ie=()=>{if(he)return he;const e=window.location.pathname.split("/"),t=e.indexOf("match");return-1!==t&&e[t+1]?e[t+1]:null};if((0,r.useEffect)((()=>{(async()=>{const e=Ie();if(e)try{console.log("MatchDetailPage: Loading match data for ID:",e);const S=await Ve.get("/matches/".concat(e)),C=(null===S||void 0===S?void 0:S.data)||S;console.log("MatchDetailPage: Loaded match data:",C);const M=new URLSearchParams(window.location.hash.split("?")[1]||"").get("map");if(M){const e=parseInt(M)-1;e>=0&&(console.log("MatchDetailPage: Setting initial map from URL parameter:",M),Ae(e),setTimeout((()=>{const e=document.querySelector(".match-statistics-section");e&&e.scrollIntoView({behavior:"smooth",block:"start"})}),500))}let D;if(C.data?D=C.data:C.match?D=C.match:C.id&&(D=C),D){var t,a,r,o,n,l,i,d,c,m,u,x,v,h,p,g,y,b,f,k,j,_,w,N,A;const e=(null===(t=D.score)||void 0===t?void 0:t.maps)||D.maps_data||D.maps||[],S=ze(e),M=void 0!==D.team1_score&&null!==D.team1_score||void 0!==(null===(a=D.score)||void 0===a?void 0:a.team1)&&null!==(null===(r=D.score)||void 0===r?void 0:r.team1);console.log("\ud83c\udfc6 Match loading - Explicit score:",M,"Calculated score:",S);const E=(0,s.A)((0,s.A)({},D),{},{team1_score:null!==(o=null!==(n=null!==(l=D.team1_score)&&void 0!==l?l:D.series_score_team1)&&void 0!==n?n:null===(i=D.score)||void 0===i?void 0:i.team1)&&void 0!==o?o:M?0:S.team1Score,team2_score:null!==(d=null!==(c=null!==(m=D.team2_score)&&void 0!==m?m:D.series_score_team2)&&void 0!==c?c:null===(u=D.score)||void 0===u?void 0:u.team2)&&void 0!==d?d:M?0:S.team2Score,series_score_team1:null!==(x=null!==(v=D.series_score_team1)&&void 0!==v?v:D.team1_score)&&void 0!==x?x:0,series_score_team2:null!==(h=null!==(p=D.series_score_team2)&&void 0!==p?p:D.team2_score)&&void 0!==h?h:0,team1:C.team1||D.team1||null,team2:C.team2||D.team2||null,maps:e,stream_url:(null===(g=D.broadcast)||void 0===g||null===(y=g.streams)||void 0===y?void 0:y[0])||D.stream_url,betting_url:(null===(b=D.broadcast)||void 0===b||null===(f=b.betting)||void 0===f?void 0:f[0])||D.betting_url,vod_url:(null===(k=D.broadcast)||void 0===k||null===(j=k.vods)||void 0===j?void 0:j[0])||D.vod_url,broadcast:D.broadcast||{streams:D.stream_url?[D.stream_url]:[],betting:D.betting_url?[D.betting_url]:[],vods:D.vod_url?[D.vod_url]:[]},status:(null===(_=D.match_info)||void 0===_?void 0:_.status)||D.status||"upcoming",format:D.format||"BO3",current_map:(null===(w=D.match_info)||void 0===w?void 0:w.current_map)||D.current_map||1,event:D.event||null,scheduled_at:(null===(N=D.match_info)||void 0===N?void 0:N.scheduled_at)||D.scheduled_at,round:D.round||(null===(A=D.match_info)||void 0===A?void 0:A.round)||null});console.log("MatchDetailPage: Transformed match data:",E),je(E),console.log("Match loaded. Live updates enabled via LiveScoreSync for status:",E.status)}}catch(S){console.error("MatchDetailPage: Error loading match:",S)}finally{we(!1)}else we(!1)})()}),[he,Ve,ze]),_e)return(0,m.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,m.jsx)("div",{className:"text-xl text-gray-600 dark:text-gray-400",children:"Loading match..."})});if(!ke)return(0,m.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,m.jsx)("div",{className:"text-xl text-gray-600 dark:text-gray-400",children:"Match not found"})});const Re=(null===(t=ke.maps)||void 0===t||null===(a=t[Ne])||void 0===a?void 0:a.team1_composition)||(null===(l=ke.maps)||void 0===l||null===(c=l[Ne])||void 0===c?void 0:c.team1_players)||(null===(u=ke.team1)||void 0===u?void 0:u.players)||(null===(x=ke.team1)||void 0===x?void 0:x.roster)||[],He=(null===(v=ke.maps)||void 0===v||null===(h=v[Ne])||void 0===h?void 0:h.team2_composition)||(null===(p=ke.maps)||void 0===p||null===(g=p[Ne])||void 0===g?void 0:g.team2_players)||(null===(y=ke.team2)||void 0===y?void 0:y.players)||(null===(b=ke.team2)||void 0===b?void 0:b.roster)||[];console.log("Map switching debug:",{currentMapIndex:Ne,mapData:null===(_=ke.maps)||void 0===_?void 0:_[Ne],hasComposition:!(null===(w=ke.maps)||void 0===w||null===(N=w[Ne])||void 0===N||!N.team1_composition),compositionLength:null===(A=ke.maps)||void 0===A||null===(S=A[Ne])||void 0===S||null===(C=S.team1_composition)||void 0===C?void 0:C.length}),console.log("Player data check:",{team1Players:Re,team2Players:He,team1PlayersLength:null===Re||void 0===Re?void 0:Re.length,team2PlayersLength:null===He||void 0===He?void 0:He.length});const We=(e,t)=>e&&t?e.map((e=>{const a=t.find((t=>t.id===e.player_id||t.id===e.id));return(0,s.A)((0,s.A)({},e),{},{heroes:(null===a||void 0===a?void 0:a.heroes)||e.heroes||[]})})):e||[],qe={team1Players:We(Re,null===(M=ke.team1)||void 0===M?void 0:M.players),team2Players:We(He,null===(D=ke.team2)||void 0===D?void 0:D.players),mapName:(null===(E=ke.maps)||void 0===E||null===(T=E[Ne])||void 0===T?void 0:T.map_name)||(null===(P=ke.maps)||void 0===P||null===(F=P[Ne])||void 0===F?void 0:F.mapName)||"TBD",gameMode:(null===(L=ke.maps)||void 0===L||null===(B=L[Ne])||void 0===B?void 0:B.game_mode)||(null===(V=ke.maps)||void 0===V||null===(z=V[Ne])||void 0===z?void 0:z.mode)||"TBD",team1Score:(null===(U=ke.maps)||void 0===U||null===(O=U[Ne])||void 0===O?void 0:O.team1_score)||0,team2Score:(null===(I=ke.maps)||void 0===I||null===(R=I[Ne])||void 0===R?void 0:R.team2_score)||0};return(0,m.jsx)(j,{children:(0,m.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,m.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-6",children:[(0,m.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm mb-4",children:[(0,m.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsx)("button",{onClick:()=>pe&&pe("matches"),className:"text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100 transition-colors",children:"\u2190 Back to Matches"}),(0,m.jsxs)("div",{className:"flex items-center space-x-4",children:["live"===(null===ke||void 0===ke?void 0:ke.status)&&(0,m.jsxs)("div",{className:"flex items-center gap-2",children:[(0,m.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1 rounded text-sm transition-colors ".concat(null!==Te&&void 0!==Te&&Te.hasLocalConnection&&"connected"===(null===Te||void 0===Te||null===(H=Te.serviceStatus)||void 0===H?void 0:H.status)?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":"reconnecting"===(null===Te||void 0===Te||null===(W=Te.serviceStatus)||void 0===W?void 0:W.status)?"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200":"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200"),children:[(0,m.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(null!==Te&&void 0!==Te&&Te.hasLocalConnection&&"connected"===(null===Te||void 0===Te||null===(q=Te.serviceStatus)||void 0===q?void 0:q.status)?"bg-green-500 animate-pulse":"reconnecting"===(null===Te||void 0===Te||null===(Y=Te.serviceStatus)||void 0===Y?void 0:Y.status)?"bg-yellow-500 animate-spin":"bg-red-500 animate-pulse")}),null!==Te&&void 0!==Te&&Te.hasLocalConnection&&"connected"===(null===Te||void 0===Te||null===(G=Te.serviceStatus)||void 0===G?void 0:G.status)?"Live (".concat((null===(K=Te.serviceStatus.transport)||void 0===K?void 0:K.toUpperCase())||"SSE",")"):"reconnecting"===(null===Te||void 0===Te||null===(J=Te.serviceStatus)||void 0===J?void 0:J.status)?"Reconnecting...":"Live Updates"]}),(null===Te||void 0===Te||null===(Z=Te.serviceStatus)||void 0===Z?void 0:Z.reconnectAttempts)>0&&(0,m.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Attempt ",Te.serviceStatus.reconnectAttempts]})]}),((null===(Q=ke.event)||void 0===Q?void 0:Q.name)||(null===(X=ke.tournament)||void 0===X?void 0:X.name))&&(0,m.jsxs)("div",{className:"cursor-pointer hover:text-blue-600 dark:hover:text-blue-400 transition-colors",onClick:()=>{var e;return(null===(e=ke.event)||void 0===e?void 0:e.id)&&pe&&pe("event-detail",ke.event.id)},children:[(0,m.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:(null===($=ke.event)||void 0===$?void 0:$.name)||(null===(ee=ke.tournament)||void 0===ee?void 0:ee.name)}),ke.round&&(0,m.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-500 ml-2",children:["\u2022 ",ke.round]})]}),(0,m.jsx)("span",{className:"px-3 py-1 rounded text-xs font-semibold uppercase ".concat("live"===ke.status?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":"completed"===ke.status?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"),children:ke.status||"upcoming"})]})]})}),(0,m.jsx)("div",{className:"py-8",children:(0,m.jsx)("div",{className:"flex items-center justify-center",children:(0,m.jsxs)("div",{className:"flex items-center space-x-12",children:[(0,m.jsxs)("div",{className:"flex flex-col items-center cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>{var e;return pe&&pe("team-detail",null===(e=ke.team1)||void 0===e?void 0:e.id)},children:[(0,m.jsx)("div",{className:"w-20 h-20 mb-3",children:(0,m.jsx)("img",{src:(0,n.Gv)(ke.team1),alt:(null===(te=ke.team1)||void 0===te?void 0:te.name)||"Team 1",className:"w-full h-full object-contain",onError:e=>{console.log("\ud83d\uddbc\ufe0f Team 1 logo failed to load, using fallback"),e.target.src=(0,n.VG)(null,"team-logo")}})}),(0,m.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400",children:(null===(ae=ke.team1)||void 0===ae?void 0:ae.name)||"TBD"}),(null===(se=ke.team1)||void 0===se?void 0:se.country)&&(0,m.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:[(0,n.xg)(ke.team1.country)," ",ke.team1.country]})]}),(0,m.jsxs)("div",{className:"text-center px-8",children:[(0,m.jsxs)("div",{className:"flex items-center justify-center space-x-6 mb-4",children:[(0,m.jsx)("span",{className:"text-4xl font-bold text-gray-900 dark:text-white",children:ke.team1_score||0}),(0,m.jsx)("span",{className:"text-2xl text-gray-400",children:":"}),(0,m.jsx)("span",{className:"text-4xl font-bold text-gray-900 dark:text-white",children:ke.team2_score||0})]}),(0,m.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:ke.format||"Best of 3"}),(0,m.jsx)("div",{className:"flex items-center justify-center space-x-2",children:Array.from({length:(()=>{var e;const t=null===(e=ke.format)||void 0===e?void 0:e.toUpperCase();if("BO1"===t||"BEST OF 1"===t)return 1;if("BO2"===t||"BEST OF 2"===t)return 2;if("BO3"===t||"BEST OF 3"===t)return 3;if("BO4"===t||"BEST OF 4"===t)return 4;if("BO5"===t||"BEST OF 5"===t)return 5;if("BO6"===t||"BEST OF 6"===t)return 6;if("BO7"===t||"BEST OF 7"===t)return 7;if("BO8"===t||"BEST OF 8"===t)return 8;if("BO9"===t||"BEST OF 9"===t)return 9;const a=null===t||void 0===t?void 0:t.match(/\d+/);if(a){const e=parseInt(a[0]);if(e>=1&&e<=9)return e}return 3})()},((e,t)=>{var a,s,r;const o=null===(a=ke.maps)||void 0===a?void 0:a[t],n=t===Ne,l=o&&o.team1_score>o.team2_score,i=o&&o.team2_score>o.team1_score,d=o&&(o.team1_score||o.team2_score);return(0,m.jsx)("div",{onClick:()=>{o&&(console.log("MatchDetailPage: Switching to map ".concat(t+1,":"),o),Ae(t))},className:"relative cursor-pointer transition-all ".concat(n?"scale-110":"hover:scale-105"),children:(0,m.jsxs)("div",{className:"w-20 h-24 rounded-lg border-2 flex flex-col items-center justify-center transition-all cursor-pointer hover:shadow-md ".concat(n?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 shadow-lg scale-105":d?"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 hover:border-blue-300":"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900 hover:border-gray-300"),children:[(0,m.jsxs)("div",{className:"text-xs font-medium ".concat(n?"text-blue-600 dark:text-blue-400":"text-gray-500 dark:text-gray-400"),children:["Map ",t+1]}),(null===o||void 0===o?void 0:o.map_name)&&(0,m.jsx)("div",{className:"text-xs text-center px-1 text-gray-600 dark:text-gray-300 font-medium truncate w-full",children:o.map_name}),o?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("div",{className:"text-sm font-bold ".concat(n?"text-blue-900 dark:text-blue-100":"text-gray-900 dark:text-white"),children:[o.team1_score||0,"-",o.team2_score||0]}),(0,m.jsx)("div",{className:"text-xs ".concat(l?"text-blue-600 dark:text-blue-400":i?"text-red-600 dark:text-red-400":"text-gray-400"),children:l?(null===(s=ke.team1)||void 0===s?void 0:s.short_name)||"T1":i?(null===(r=ke.team2)||void 0===r?void 0:r.short_name)||"T2":"Live"})]}):(0,m.jsx)("div",{className:"text-xs text-gray-400",children:"TBD"})]})},t)}))}),ke.scheduled_at&&(0,m.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-500 mt-3",children:[new Date(ke.scheduled_at).toLocaleDateString()," \u2022 ",new Date(ke.scheduled_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),(0,m.jsxs)("div",{className:"flex flex-col items-center cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>{var e;return pe&&pe("team-detail",null===(e=ke.team2)||void 0===e?void 0:e.id)},children:[(0,m.jsx)("div",{className:"w-20 h-20 mb-3",children:(0,m.jsx)("img",{src:(0,n.Gv)(ke.team2),alt:(null===(re=ke.team2)||void 0===re?void 0:re.name)||"Team 2",className:"w-full h-full object-contain",onError:e=>{console.log("\ud83d\uddbc\ufe0f Team 2 logo failed to load, using fallback"),e.target.src=(0,n.VG)(null,"team-logo")}})}),(0,m.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white hover:text-red-600 dark:hover:text-red-400",children:(null===(oe=ke.team2)||void 0===oe?void 0:oe.name)||"TBD"}),(null===(ne=ke.team2)||void 0===ne?void 0:ne.country)&&(0,m.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:[(0,n.xg)(ke.team2.country)," ",ke.team2.country]})]})]})})})]}),(0,m.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border border-blue-200 dark:border-blue-700 rounded-lg shadow-sm mb-4 p-4",children:(0,m.jsxs)("div",{className:"flex items-center justify-center space-x-6 text-sm",children:[(0,m.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,m.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),(0,m.jsx)("span",{className:"font-medium text-blue-700 dark:text-blue-300",children:"Currently Viewing:"}),(0,m.jsxs)("span",{className:"font-bold text-blue-900 dark:text-blue-100 bg-blue-100 dark:bg-blue-800 px-2 py-1 rounded",children:["Map ",Ne+1]})]}),(0,m.jsx)("div",{className:"text-blue-300 dark:text-blue-600",children:"|"}),(0,m.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,m.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:"Map:"}),(0,m.jsx)("span",{className:"font-semibold text-gray-900 dark:text-white",children:qe.mapName})]}),(0,m.jsx)("div",{className:"text-gray-300 dark:text-gray-600",children:"|"}),(0,m.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,m.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:"Mode:"}),(0,m.jsx)("span",{className:"font-semibold text-gray-900 dark:text-white",children:qe.gameMode})]}),(0,m.jsx)("div",{className:"text-gray-300 dark:text-gray-600",children:"|"}),(0,m.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,m.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:"Score:"}),(0,m.jsxs)("span",{className:"font-semibold text-gray-900 dark:text-white",children:[qe.team1Score," - ",qe.team2Score]})]})]})}),((null===(le=ke.broadcast)||void 0===le||null===(ie=le.streams)||void 0===ie?void 0:ie.length)>0||(null===(de=ke.broadcast)||void 0===de||null===(ce=de.betting)||void 0===ce?void 0:ce.length)>0||(null===(me=ke.broadcast)||void 0===me||null===(ue=me.vods)||void 0===ue?void 0:ue.length)>0||ke.stream_url||ke.vod_url||ke.betting_url)&&(0,m.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm mb-4 p-4",children:(0,m.jsx)("div",{className:"flex flex-wrap items-center justify-center gap-2",children:((e,t,a)=>{const s=[...(null===(e=ke.broadcast)||void 0===e?void 0:e.streams)||[],ke.stream_url].filter(Boolean),r=[...(null===(t=ke.broadcast)||void 0===t?void 0:t.betting)||[],ke.betting_url].filter(Boolean),o=[...(null===(a=ke.broadcast)||void 0===a?void 0:a.vods)||[],ke.vod_url].filter(Boolean),n=(e,t)=>e.map(((e,a)=>{const s=(e=>{if(!e)return null;try{const s=new URL(e),r=s.hostname.toLowerCase();if(r.includes("twitch.tv")){const e=s.pathname.split("/").filter((e=>e))[0]||"Channel";return{platform:e,display:e,color:"purple",category:"streaming"}}if(r.includes("youtube.com")||r.includes("youtu.be")){var t;const e=s.pathname.split("/").filter((e=>e));let r="YouTube";if(e.includes("c")&&e[e.indexOf("c")+1])r=e[e.indexOf("c")+1];else if(e.includes("channel")&&e[e.indexOf("channel")+1])r=e[e.indexOf("channel")+1];else if(e.includes("@")||null!==(t=e[0])&&void 0!==t&&t.startsWith("@")){var a;r=(null===(a=e[0])||void 0===a?void 0:a.replace("@",""))||"YouTube"}return{platform:r,display:r,color:"red",category:"streaming"}}if(r.includes("kick.com")){const e=s.pathname.split("/").filter((e=>e))[0]||"Channel";return{platform:e,display:e,color:"green",category:"streaming"}}if(r.includes("bet")||r.includes("odds")||r.includes("stake")){const e=r.split(".")[0].charAt(0).toUpperCase()+r.split(".")[0].slice(1);return{platform:e,display:e,color:"yellow",category:"betting"}}{const e=r.split(".")[0].charAt(0).toUpperCase()+r.split(".")[0].slice(1);return{platform:e,display:e,color:"blue",category:"vod"}}}catch(s){return{platform:"External Link",display:"External Link",color:"gray",category:"other"}}})(e);if(!s)return null;return(0,m.jsxs)("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1 ".concat({purple:"bg-purple-600 hover:bg-purple-700",red:"bg-red-600 hover:bg-red-700",green:"bg-green-600 hover:bg-green-700",blue:"bg-blue-600 hover:bg-blue-700",yellow:"bg-yellow-600 hover:bg-yellow-700",gray:"bg-gray-600 hover:bg-gray-700"}[s.color]," text-white rounded transition-colors text-xs font-medium flex items-center hover:shadow-md"),children:[(0,m.jsx)("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:(0,m.jsx)("path",{fillRule:"evenodd",d:"M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z",clipRule:"evenodd"})}),s.platform]},"".concat(t,"-").concat(a))})),l=[];return s.length>0&&l.push((0,m.jsxs)("div",{className:"flex items-center gap-2",children:[(0,m.jsx)("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Streaming:"}),n(s,"streaming")]},"streaming")),l.length>0&&(r.length>0||o.length>0)&&l.push((0,m.jsx)("div",{className:"text-gray-300 dark:text-gray-600",children:"|"},"sep1")),r.length>0&&l.push((0,m.jsxs)("div",{className:"flex items-center gap-2",children:[(0,m.jsx)("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Betting:"}),n(r,"betting")]},"betting")),(s.length>0||r.length>0)&&o.length>0&&l.push((0,m.jsx)("div",{className:"text-gray-300 dark:text-gray-600",children:"|"},"sep2")),o.length>0&&l.push((0,m.jsxs)("div",{className:"flex items-center gap-2",children:[(0,m.jsx)("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"VOD:"}),n(o,"vod")]},"vod")),l})()})}),(0,m.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm mb-4 match-statistics-section",children:[(0,m.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Match Statistics - Map ",Ne+1,": ",qe.mapName]}),Le&&("admin"===Le.role||"moderator"===Le.role)&&(0,m.jsx)("div",{className:"flex gap-2",children:(0,m.jsx)("button",{onClick:()=>Ee(!De),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors text-sm",children:"Live Scoring"})})]})}),(0,m.jsxs)("div",{className:"overflow-x-auto",children:[(0,m.jsxs)("table",{className:"w-full",children:[(0,m.jsxs)("thead",{children:[(0,m.jsx)("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,m.jsx)("th",{colSpan:"9",className:"px-6 py-3 text-left",children:(0,m.jsx)("span",{className:"text-sm font-semibold text-blue-600 dark:text-blue-400 cursor-pointer hover:underline",onClick:()=>{var e;return pe&&pe("team-detail",null===(e=ke.team1)||void 0===e?void 0:e.id)},children:(null===(xe=ke.team1)||void 0===xe?void 0:xe.name)||"TBD"})})}),(0,m.jsxs)("tr",{className:"bg-gray-50 dark:bg-gray-700 text-xs uppercase tracking-wider text-gray-600 dark:text-gray-300",children:[(0,m.jsx)("th",{className:"px-6 py-3 text-left font-medium",children:"Player"}),(0,m.jsx)("th",{className:"px-3 py-3 text-center font-medium",children:"Hero"}),(0,m.jsx)("th",{className:"px-3 py-3 text-center font-medium",children:"K"}),(0,m.jsx)("th",{className:"px-3 py-3 text-center font-medium",children:"D"}),(0,m.jsx)("th",{className:"px-3 py-3 text-center font-medium",children:"A"}),(0,m.jsx)("th",{className:"px-3 py-3 text-center font-medium",children:"KDA"}),(0,m.jsx)("th",{className:"px-3 py-3 text-center font-medium",children:"DMG"}),(0,m.jsx)("th",{className:"px-3 py-3 text-center font-medium",children:"Heal"}),(0,m.jsx)("th",{className:"px-3 py-3 text-center font-medium",children:"BLK"})]})]}),(0,m.jsx)("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:qe.team1Players.length>0?qe.team1Players.map(((e,t)=>{const a=e.player_id||e.id,r=(()=>{var t,s,r,o,n;const l=[];e.hero&&l.push({hero:e.hero,eliminations:e.eliminations||0,deaths:e.deaths||0,assists:e.assists||0,damage_dealt:e.damage||0,healing_done:e.healing||0,damage_blocked:e.damage_blocked||0});const i=(null===(t=ke.team1)||void 0===t||null===(s=t.players)||void 0===s?void 0:s.find((e=>e.id===a)))||(null===(r=ke.team2)||void 0===r||null===(o=r.players)||void 0===o?void 0:o.find((e=>e.id===a)));return 0===Ne&&(null===i||void 0===i||null===(n=i.heroes)||void 0===n?void 0:n.length)>0?i.heroes:l.length>0?l:[]})(),o=ge["".concat(a,"_").concat(Ne)]||0,l=r[o]||{},d={id:e.id||e.player_id,name:(e=>{if(!e)return"Unknown Player";if(e.username)return e.username;if(e.name&&"string"===typeof e.name){const t=e.name.match(/"([^"]+)"/);if(t)return t[1];const a=e.name.match(/'([^']+)'/);if(a)return a[1];const s=e.name.match(/^"([^"]+)"/);if(s)return s[1]}return e.player_name||e.name||"Unknown"})(e),country:e.country||e.nationality||"US",hero:l.hero||e.hero||e.current_hero||null,heroes:r,eliminations:l.eliminations||e.eliminations||e.kills||0,deaths:l.deaths||e.deaths||0,assists:l.assists||e.assists||0,damage:l.damage_dealt||e.damage||0,healing:l.healing_done||e.healing||0,damage_blocked:l.damage_blocked||e.damage_blocked||e.damage_mitigated||e.damageBlocked||0};return(0,m.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[(0,m.jsx)("td",{className:"px-6 py-3",children:(0,m.jsxs)("div",{className:"flex items-center space-x-2 cursor-pointer hover:text-blue-600 dark:hover:text-blue-400",onClick:()=>pe&&pe("player-detail",d.id),children:[(0,m.jsx)("span",{className:"text-sm",children:(0,n.xg)(d.country)}),(0,m.jsx)("span",{className:"font-medium text-sm",children:d.name})]})}),(0,m.jsx)("td",{className:"px-3 py-3 relative",children:(0,m.jsx)("div",{className:"flex justify-center items-center",children:d.heroes&&d.heroes.length>1?(0,m.jsxs)("div",{className:"relative flex items-center hero-menu-container",children:[d.heroes.slice(1,Math.min(3,d.heroes.length)).map(((e,t)=>(0,m.jsx)("div",{className:"absolute transition-all",style:{left:"".concat(10*(t+1),"px"),zIndex:3-t,opacity:.5-.1*t,filter:"brightness(0.8)"},children:(0,m.jsx)(i.A,{heroName:e.hero,size:"sm",showRole:!1})},"shadow-".concat(t)))),(0,m.jsxs)("div",{className:"relative cursor-pointer transition-all hover:scale-110",style:{zIndex:10},onClick:()=>{const e="".concat(a,"_").concat(Ne);fe((t=>(0,s.A)((0,s.A)({},t),{},{[e]:!t[e]})))},title:"".concat(d.heroes[o].hero,": ").concat(d.heroes[o].eliminations,"/").concat(d.heroes[o].deaths,"/").concat(d.heroes[o].assists),children:[(0,m.jsx)(i.A,{heroName:d.heroes[o].hero,size:"sm",showRole:!1}),d.heroes.length>1&&(0,m.jsx)("div",{className:"absolute -top-0.5 -right-0.5 bg-blue-500/80 text-white text-[10px] rounded-full w-3.5 h-3.5 flex items-center justify-center font-medium",children:d.heroes.length})]}),be["".concat(a,"_").concat(Ne)]&&(0,m.jsxs)("div",{className:"absolute top-full mt-2 right-0 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 p-2 z-50 min-w-[200px]",children:[(0,m.jsxs)("div",{className:"text-xs font-semibold text-gray-600 dark:text-gray-400 px-2 py-1 mb-1",children:["Select Hero (",d.heroes.length," played)"]}),d.heroes.map(((e,t)=>(0,m.jsxs)("div",{className:"flex items-center space-x-2 p-2 rounded cursor-pointer transition-colors ".concat(o===t?"bg-blue-100 dark:bg-blue-900/50":"hover:bg-gray-100 dark:hover:bg-gray-700"),onClick:e=>{e.stopPropagation(),ye((e=>(0,s.A)((0,s.A)({},e),{},{["".concat(a,"_").concat(Ne)]:t}))),fe((e=>(0,s.A)((0,s.A)({},e),{},{["".concat(a,"_").concat(Ne)]:!1})))},children:[(0,m.jsx)(i.A,{heroName:e.hero,size:"sm",showRole:!1}),(0,m.jsxs)("div",{className:"flex-1",children:[(0,m.jsx)("div",{className:"font-medium text-sm text-gray-900 dark:text-white",children:e.hero}),(0,m.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[e.eliminations,"/",e.deaths,"/",e.assists," \u2022 KDA: ",((e.eliminations+e.assists)/Math.max(e.deaths,1)).toFixed(2)]})]}),o===t&&(0,m.jsx)("div",{className:"text-blue-500 dark:text-blue-400",children:"\u2713"})]},t)))]})]}):(0,m.jsx)(i.A,{heroName:d.hero,size:"sm",showRole:!1})})}),(0,m.jsx)("td",{className:"px-3 py-3 text-center text-sm font-medium",children:d.eliminations}),(0,m.jsx)("td",{className:"px-3 py-3 text-center text-sm",children:d.deaths}),(0,m.jsx)("td",{className:"px-3 py-3 text-center text-sm",children:d.assists}),(0,m.jsx)("td",{className:"px-3 py-3 text-center text-sm font-medium",children:((d.eliminations+d.assists)/Math.max(d.deaths,1)).toFixed(2)}),(0,m.jsx)("td",{className:"px-3 py-3 text-center text-sm",children:d.damage?"".concat((d.damage/1e3).toFixed(1),"k"):"-"}),(0,m.jsx)("td",{className:"px-3 py-3 text-center text-sm",children:d.healing?"".concat((d.healing/1e3).toFixed(1),"k"):"-"}),(0,m.jsx)("td",{className:"px-3 py-3 text-center text-sm",children:d.damage_blocked?"".concat((d.damage_blocked/1e3).toFixed(1),"k"):"-"})]},t)})):(0,m.jsx)("tr",{children:(0,m.jsx)("td",{colSpan:"9",className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:"No player data available for this map"})})})]}),(0,m.jsxs)("table",{className:"w-full mt-6",children:[(0,m.jsxs)("thead",{children:[(0,m.jsx)("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,m.jsx)("th",{colSpan:"9",className:"px-6 py-3 text-left",children:(0,m.jsx)("span",{className:"text-sm font-semibold text-red-600 dark:text-red-400 cursor-pointer hover:underline",onClick:()=>{var e;return pe&&pe("team-detail",null===(e=ke.team2)||void 0===e?void 0:e.id)},children:(null===(ve=ke.team2)||void 0===ve?void 0:ve.name)||"TBD"})})}),(0,m.jsxs)("tr",{className:"bg-gray-50 dark:bg-gray-700 text-xs uppercase tracking-wider text-gray-600 dark:text-gray-300",children:[(0,m.jsx)("th",{className:"px-6 py-3 text-left font-medium",children:"Player"}),(0,m.jsx)("th",{className:"px-3 py-3 text-center font-medium",children:"Hero"}),(0,m.jsx)("th",{className:"px-3 py-3 text-center font-medium",children:"K"}),(0,m.jsx)("th",{className:"px-3 py-3 text-center font-medium",children:"D"}),(0,m.jsx)("th",{className:"px-3 py-3 text-center font-medium",children:"A"}),(0,m.jsx)("th",{className:"px-3 py-3 text-center font-medium",children:"KDA"}),(0,m.jsx)("th",{className:"px-3 py-3 text-center font-medium",children:"DMG"}),(0,m.jsx)("th",{className:"px-3 py-3 text-center font-medium",children:"Heal"}),(0,m.jsx)("th",{className:"px-3 py-3 text-center font-medium",children:"BLK"})]})]}),(0,m.jsx)("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:qe.team2Players.length>0?qe.team2Players.map(((e,t)=>{const a=e.player_id||e.id,r=(()=>{var t,s,r,o,n;const l=[];e.hero&&l.push({hero:e.hero,eliminations:e.eliminations||0,deaths:e.deaths||0,assists:e.assists||0,damage_dealt:e.damage||0,healing_done:e.healing||0,damage_blocked:e.damage_blocked||0});const i=(null===(t=ke.team1)||void 0===t||null===(s=t.players)||void 0===s?void 0:s.find((e=>e.id===a)))||(null===(r=ke.team2)||void 0===r||null===(o=r.players)||void 0===o?void 0:o.find((e=>e.id===a)));return 0===Ne&&(null===i||void 0===i||null===(n=i.heroes)||void 0===n?void 0:n.length)>0?i.heroes:l.length>0?l:[]})(),o=ge["".concat(a,"_").concat(Ne)]||0,l=r[o]||{},d={id:e.id||e.player_id,name:(e=>{if(!e)return"Unknown Player";if(e.username)return e.username;if(e.name&&"string"===typeof e.name){const t=e.name.match(/"([^"]+)"/);if(t)return t[1];const a=e.name.match(/'([^']+)'/);if(a)return a[1];const s=e.name.match(/^"([^"]+)"/);if(s)return s[1]}return e.player_name||e.name||"Unknown"})(e),country:e.country||e.nationality||"US",hero:l.hero||e.hero||e.current_hero||null,heroes:r,eliminations:l.eliminations||e.eliminations||e.kills||0,deaths:l.deaths||e.deaths||0,assists:l.assists||e.assists||0,damage:l.damage_dealt||e.damage||0,healing:l.healing_done||e.healing||0,damage_blocked:l.damage_blocked||e.damage_blocked||e.damage_mitigated||e.damageBlocked||0};return(0,m.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[(0,m.jsx)("td",{className:"px-6 py-3",children:(0,m.jsxs)("div",{className:"flex items-center space-x-2 cursor-pointer hover:text-red-600 dark:hover:text-red-400",onClick:()=>pe&&pe("player-detail",d.id),children:[(0,m.jsx)("span",{className:"text-sm",children:(0,n.xg)(d.country)}),(0,m.jsx)("span",{className:"font-medium text-sm",children:d.name})]})}),(0,m.jsx)("td",{className:"px-3 py-3 relative",children:(0,m.jsx)("div",{className:"flex justify-center items-center",children:d.heroes&&d.heroes.length>1?(0,m.jsxs)("div",{className:"relative flex items-center hero-menu-container",children:[d.heroes.slice(1,Math.min(3,d.heroes.length)).map(((e,t)=>(0,m.jsx)("div",{className:"absolute transition-all",style:{left:"".concat(10*(t+1),"px"),zIndex:3-t,opacity:.5-.1*t,filter:"brightness(0.8)"},children:(0,m.jsx)(i.A,{heroName:e.hero,size:"sm",showRole:!1})},"shadow-".concat(t)))),(0,m.jsxs)("div",{className:"relative cursor-pointer transition-all hover:scale-110",style:{zIndex:10},onClick:()=>{const e="".concat(a,"_").concat(Ne);fe((t=>(0,s.A)((0,s.A)({},t),{},{[e]:!t[e]})))},title:"".concat(d.heroes[o].hero,": ").concat(d.heroes[o].eliminations,"/").concat(d.heroes[o].deaths,"/").concat(d.heroes[o].assists),children:[(0,m.jsx)(i.A,{heroName:d.heroes[o].hero,size:"sm",showRole:!1}),d.heroes.length>1&&(0,m.jsx)("div",{className:"absolute -top-0.5 -right-0.5 bg-blue-500/80 text-white text-[10px] rounded-full w-3.5 h-3.5 flex items-center justify-center font-medium",children:d.heroes.length})]}),be["".concat(a,"_").concat(Ne)]&&(0,m.jsxs)("div",{className:"absolute top-full mt-2 right-0 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 p-2 z-50 min-w-[200px]",children:[(0,m.jsxs)("div",{className:"text-xs font-semibold text-gray-600 dark:text-gray-400 px-2 py-1 mb-1",children:["Select Hero (",d.heroes.length," played)"]}),d.heroes.map(((e,t)=>(0,m.jsxs)("div",{className:"flex items-center space-x-2 p-2 rounded cursor-pointer transition-colors ".concat(o===t?"bg-blue-100 dark:bg-blue-900/50":"hover:bg-gray-100 dark:hover:bg-gray-700"),onClick:e=>{e.stopPropagation(),ye((e=>(0,s.A)((0,s.A)({},e),{},{["".concat(a,"_").concat(Ne)]:t}))),fe((e=>(0,s.A)((0,s.A)({},e),{},{["".concat(a,"_").concat(Ne)]:!1})))},children:[(0,m.jsx)(i.A,{heroName:e.hero,size:"sm",showRole:!1}),(0,m.jsxs)("div",{className:"flex-1",children:[(0,m.jsx)("div",{className:"font-medium text-sm text-gray-900 dark:text-white",children:e.hero}),(0,m.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[e.eliminations,"/",e.deaths,"/",e.assists," \u2022 KDA: ",((e.eliminations+e.assists)/Math.max(e.deaths,1)).toFixed(2)]})]}),o===t&&(0,m.jsx)("div",{className:"text-blue-500 dark:text-blue-400",children:"\u2713"})]},t)))]})]}):(0,m.jsx)(i.A,{heroName:d.hero,size:"sm",showRole:!1})})}),(0,m.jsx)("td",{className:"px-3 py-3 text-center text-sm font-medium",children:d.eliminations}),(0,m.jsx)("td",{className:"px-3 py-3 text-center text-sm",children:d.deaths}),(0,m.jsx)("td",{className:"px-3 py-3 text-center text-sm",children:d.assists}),(0,m.jsx)("td",{className:"px-3 py-3 text-center text-sm font-medium",children:((d.eliminations+d.assists)/Math.max(d.deaths,1)).toFixed(2)}),(0,m.jsx)("td",{className:"px-3 py-3 text-center text-sm",children:d.damage?"".concat((d.damage/1e3).toFixed(1),"k"):"-"}),(0,m.jsx)("td",{className:"px-3 py-3 text-center text-sm",children:d.healing?"".concat((d.healing/1e3).toFixed(1),"k"):"-"}),(0,m.jsx)("td",{className:"px-3 py-3 text-center text-sm",children:d.damage_blocked?"".concat((d.damage_blocked/1e3).toFixed(1),"k"):"-"})]},t)})):(0,m.jsx)("tr",{children:(0,m.jsx)("td",{colSpan:"9",className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:"No player data available for this map"})})})]})]})]}),(0,m.jsx)(f,{matchId:Ie(),navigateTo:pe}),(0,m.jsx)(d.default,{isOpen:De,match:ke,onClose:()=>Ee(!1),onUpdate:Ue})]})})})}const w=e=>(0,m.jsx)(j,{children:(0,m.jsx)(_,(0,s.A)({},e))})},4814:(e,t,a)=>{a.d(t,{A:()=>s});const s=(0,a(6230).A)("trash-2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},8067:(e,t,a)=>{a.d(t,{A:()=>n});var s=a(9950),r=a(5150),o=a(4414);const n=function(e){let{itemType:t,itemId:a,initialUpvotes:n=0,initialDownvotes:l=0,userVote:i=null,onVoteChange:d=null,size:c="sm",direction:m="horizontal"}=e;const{api:u,user:x,isAuthenticated:v}=(0,r.As)(),[h,p]=(0,s.useState)(n),[g,y]=(0,s.useState)(l),[b,f]=(0,s.useState)(i),[k,j]=(0,s.useState)(!1),[_,w]=(0,s.useState)(!1),N=(0,s.useRef)(!1),A={xs:"p-1 text-xs min-h-[36px] min-w-[36px]",sm:"p-1.5 text-sm min-h-[40px] min-w-[40px]",md:"p-2 text-base min-h-[44px] min-w-[44px]",lg:"p-3 text-lg min-h-[48px] min-w-[48px]"},S=(0,s.useCallback)((async()=>{if("post"!==t&&"match-comment"!==t){if(v&&"thread"===t)try{var e;const t="/forums/threads/".concat(a),o=await u.get(t),i=(null===(e=o.data)||void 0===e?void 0:e.data)||o.data;if(i){var s,r;if(!N.current)p((null===(s=i.stats)||void 0===s?void 0:s.upvotes)||i.upvotes||n),y((null===(r=i.stats)||void 0===r?void 0:r.downvotes)||i.downvotes||l),f(i.user_vote||null);w(!0)}}catch(o){console.warn("Could not fetch thread vote state:",o),w(!0)}}else w(!0)}),[u,t,a,v,n,l]);(0,s.useEffect)((()=>{S()}),[S]),(0,s.useEffect)((()=>{const e=()=>{console.log("Connection restored - refreshing vote state"),w(!1),N.current=!1,S()};return window.addEventListener("online",e),()=>{window.removeEventListener("online",e)}}),[S]);const C=(0,s.useRef)(a),[M,D]=(0,s.useState)(!1);(0,s.useEffect)((()=>{if(C.current!==a)p(n),y(l),f(i),w(!1),N.current=!1,C.current=a,D(!0);else if(M){if(!N.current&&(h!==n||g!==l))return}else p(n),y(l),f(i),D(!0)}),[a,n,l,i,M]),(0,s.useEffect)((()=>{console.log("ForumVotingButtons state: itemId=".concat(a,", upvotes=").concat(h,", downvotes=").concat(g,", currentVote=").concat(b,", hasVoted=").concat(N.current))}),[h,g,b,a]);const E=async e=>{if(!v)return void alert("Please log in to vote");if(k)return;j(!0);const s=h,r=g,o=b,n=document.querySelector('[data-vote-type="'.concat(e,'"]'));n&&n.classList.add("animate-pulse");try{let n;if("thread"===t)n="/forums/threads/".concat(a,"/vote");else if("post"===t)n="/forums/posts/".concat(a,"/vote");else{if("match-comment"!==t)throw new Error("Unknown item type: ".concat(t));n="/match-comments/".concat(a,"/vote")}const i=b===e,c={vote_type:e},m=await u.post(n,c);if(console.log("Forum vote raw response:",m),!1!==(null===m||void 0===m?void 0:m.success)){const t=(null===m||void 0===m?void 0:m.vote_counts)||(null===m||void 0===m?void 0:m.updated_stats)||(null===m||void 0===m?void 0:m.stats),a=null===m||void 0===m?void 0:m.user_vote,n=(null===m||void 0===m?void 0:m.action)||"voted";if(console.log("Extracted from response:",{serverCounts:t,serverUserVote:a,action:n}),N.current=!0,t&&"object"===typeof t){const e=parseInt(t.upvotes)||0,a=parseInt(t.downvotes)||0;console.log("Vote response - Setting counts: upvotes=".concat(e,", downvotes=").concat(a)),p(e),y(a)}else console.warn("No valid server counts in response, response was:",m),"removed"===n?("upvote"===o?p(Math.max(0,s-1)):"downvote"===o&&y(Math.max(0,r-1)),f(null)):"updated"!==n&&"voted"!==n||(i?("upvote"===e?p(Math.max(0,s-1)):y(Math.max(0,r-1)),f(null)):o?("upvote"===e?(p(s+1),y(Math.max(0,r-1))):(y(r+1),p(Math.max(0,s-1))),f(e)):("upvote"===e?p(s+1):y(r+1),f(e)));if(f(void 0!==a?a:"removed"===n?null:e),d){const e=t||{upvotes:(null===t||void 0===t?void 0:t.upvotes)||h,downvotes:(null===t||void 0===t?void 0:t.downvotes)||g,score:((null===t||void 0===t?void 0:t.upvotes)||h)-((null===t||void 0===t?void 0:t.downvotes)||g)};d({action:n,vote_counts:e,user_vote:void 0!==a?a:b})}}else{var l;const e=(null===(l=m.data)||void 0===l?void 0:l.message)||"Vote request failed";console.warn("Vote request unsuccessful:",e),alert(e)}}catch(A){var i;if(console.error("Vote request error:",A),409===(null===(i=A.response)||void 0===i?void 0:i.status))return;{var c,m,x;let e="Failed to record vote";if(401===(null===(c=A.response)||void 0===c?void 0:c.status))e="Please log in to vote";else if(403===(null===(m=A.response)||void 0===m?void 0:m.status))e="You do not have permission to vote on this item";else if(404===(null===(x=A.response)||void 0===x?void 0:x.status))e="This item no longer exists or has been deleted";else{var _,w;const t=(null===(_=A.response)||void 0===_||null===(w=_.data)||void 0===w?void 0:w.message)||A.message;t&&"string"===typeof t&&(e=t)}alert(e)}}finally{j(!1);const t=document.querySelector('[data-vote-type="'.concat(e,'"]'));t&&t.classList.remove("animate-pulse")}},T=()=>h-g,P=()=>{const e=T();return e>0?"text-green-600 dark:text-green-400":e<0?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400"};return"vertical"===m?(0,o.jsxs)("div",{className:"flex flex-col items-center space-y-1",children:[(0,o.jsx)("button",{onClick:()=>E("upvote"),disabled:k,"data-vote-type":"upvote",className:"".concat(A[c]," rounded transition-all duration-200 flex items-center justify-center touch-manipulation ").concat("upvote"===b?"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400 transform scale-110 shadow-lg":"text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-green-600 dark:hover:text-green-400 active:scale-95"," ").concat(k?"opacity-50 cursor-not-allowed":"hover:shadow-md"),style:{WebkitTapHighlightColor:"rgba(34, 197, 94, 0.1)"},title:"Upvote",children:(0,o.jsx)("span",{children:"\ud83d\udc4d"})}),(0,o.jsx)("span",{className:"text-xs font-medium ".concat(P()),children:T()}),(0,o.jsx)("button",{onClick:()=>E("downvote"),disabled:k,"data-vote-type":"downvote",className:"".concat(A[c]," rounded transition-all duration-200 flex items-center justify-center touch-manipulation ").concat("downvote"===b?"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400 transform scale-110 shadow-lg":"text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-red-600 dark:hover:text-red-400 active:scale-95"," ").concat(k?"opacity-50 cursor-not-allowed":"hover:shadow-md"),style:{WebkitTapHighlightColor:"rgba(239, 68, 68, 0.1)"},title:"Downvote",children:(0,o.jsx)("span",{children:"\ud83d\udc4e"})})]}):(0,o.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,o.jsxs)("button",{onClick:()=>E("upvote"),disabled:k,"data-vote-type":"upvote",className:"".concat(A[c]," rounded transition-all duration-200 flex items-center justify-center space-x-1 touch-manipulation ").concat("upvote"===b?"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400 transform scale-105 shadow-lg":"text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-green-600 dark:hover:text-green-400 active:scale-95"," ").concat(k?"opacity-50 cursor-not-allowed":"hover:shadow-md"),style:{WebkitTapHighlightColor:"rgba(34, 197, 94, 0.1)"},title:"Upvote",children:[(0,o.jsx)("span",{children:"\ud83d\udc4d"}),(0,o.jsx)("span",{className:"text-xs font-medium",children:h})]}),"xs"!==c&&(0,o.jsx)("span",{className:"text-xs font-medium px-2 ".concat(P()),children:T()>0?"+".concat(T()):T()}),(0,o.jsxs)("button",{onClick:()=>E("downvote"),disabled:k,"data-vote-type":"downvote",className:"".concat(A[c]," rounded transition-all duration-200 flex items-center justify-center space-x-1 touch-manipulation ").concat("downvote"===b?"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400 transform scale-105 shadow-lg":"text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-red-600 dark:hover:text-red-400 active:scale-95"," ").concat(k?"opacity-50 cursor-not-allowed":"hover:shadow-md"),style:{WebkitTapHighlightColor:"rgba(239, 68, 68, 0.1)"},title:"Downvote",children:[(0,o.jsx)("span",{children:"\ud83d\udc4e"}),(0,o.jsx)("span",{className:"text-xs font-medium",children:g})]})]})}},8574:(e,t,a)=>{a.d(t,{A:()=>i});var s=a(9950),r=a(5150),o=a(8091),n=a(631),l=a(4414);const i=function(e){let{itemType:t,itemId:a,parentId:i=null,initialUpvotes:d=0,initialDownvotes:c=0,userVote:m=null,onVoteChange:u=null,size:x="sm",direction:v="horizontal"}=e;const{api:h,user:p,isAuthenticated:g}=(0,r.As)(),{triggerVote:y}=(0,o.VJ)(),[b,f]=(0,s.useState)(d),[k,j]=(0,s.useState)(c),[_,w]=(0,s.useState)(m),[N,A]=(0,s.useState)(!1),S={xs:"p-1 text-xs min-h-[36px] min-w-[36px]",sm:"p-1.5 text-sm min-h-[40px] min-w-[40px]",md:"p-2 text-base min-h-[44px] min-w-[44px]",lg:"p-3 text-lg min-h-[48px] min-w-[48px]"},C=async e=>{if(!g)return void(0,n.Ni)("Please log in to vote");if(N)return;if(a&&a.toString().startsWith("temp-"))return void(0,n.rQ)("Please wait for the post to be created before voting");_===e&&console.log("User removing existing vote:",e),A(!0);const s=b,r=k,o=_;_===e?("upvote"===e?f((e=>Math.max(0,e-1))):j((e=>Math.max(0,e-1))),w(null)):_?("upvote"===e?(f((e=>e+1)),j((e=>Math.max(0,e-1)))):(j((e=>e+1)),f((e=>Math.max(0,e-1)))),w(e)):("upvote"===e?f((e=>e+1)):j((e=>e+1)),w(e));try{var l,d,c,m,x,v;const g={votable_type:t,votable_id:a,vote_type:e,parent_id:i||null};let N;if(console.log("Sending vote request:",g),"news"===t)N=await h.post("/news/".concat(a,"/vote"),{vote_type:e});else if("news_comment"===t)try{N=await h.post("/news/comments/".concat(a,"/vote"),{vote_type:e})}catch(z){console.log("News comment vote failed, using fallback:",z.message),N=await h.post("/user/votes/",g)}else N=await h.post("/user/votes/",g);console.log("\ud83d\udcc4 Raw Response:",N),console.log("\u2705 API Success:",N.data||N);const A=N&&(!0===N.success||!0===(null===(l=N.data)||void 0===l?void 0:l.success)||N.status>=200&&N.status<300&&!1!==(null===(d=N.data)||void 0===d?void 0:d.success)&&!1!==N.success);var p,S,C;if(console.log("Vote response validation:",{responseSuccess:null===(c=N)||void 0===c?void 0:c.success,dataSuccess:null===(m=N)||void 0===m||null===(x=m.data)||void 0===x?void 0:x.success,status:null===(v=N)||void 0===v?void 0:v.status,isSuccess:A}),!A)throw console.warn("Vote request returned success=false:",null===(p=N)||void 0===p?void 0:p.data),new Error((null===(S=N)||void 0===S||null===(C=S.data)||void 0===C?void 0:C.message)||"Vote request failed");{var M,D,E,T;const t=N.data||N,a=(null===t||void 0===t?void 0:t.vote_counts)||(null===t||void 0===t||null===(M=t.data)||void 0===M?void 0:M.vote_counts)||(null===t||void 0===t?void 0:t.updated_stats),l=void 0!==(null===t||void 0===t?void 0:t.user_vote)?null===t||void 0===t?void 0:t.user_vote:void 0!==(null===t||void 0===t||null===(D=t.data)||void 0===D?void 0:D.user_vote)?null===t||void 0===t||null===(E=t.data)||void 0===E?void 0:E.user_vote:null===t||void 0===t?void 0:t.vote_type,i=(null===t||void 0===t?void 0:t.action)||(null===t||void 0===t||null===(T=t.data)||void 0===T?void 0:T.action);console.log("Vote response:",{voteCounts:a,newUserVote:l,action:i}),a?(f(Math.max(0,a.upvotes||0)),j(Math.max(0,a.downvotes||0))):i&&("removed"===i?(w(null),"upvote"===o&&f(Math.max(0,s-1)),"downvote"===o&&j(Math.max(0,r-1))):"created"===i?(w(e),"upvote"===e&&f(s+1),"downvote"===e&&j(r+1)):"updated"===i&&(w(e),"upvote"===o&&"downvote"===e?(f(Math.max(0,s-1)),j(r+1)):"downvote"===o&&"upvote"===e&&(j(Math.max(0,r-1)),f(s+1)))),void 0!==l&&w(l);const d="removed"===i?"Vote removed":"updated"===i?"Vote updated":"Vote recorded";(0,n.GF)(d,2e3),y(),u&&u({action:i||"created",vote_counts:a||{upvotes:b,downvotes:k},user_vote:_,score:b-k})}}catch(U){var P,F,L,B,V;console.error("Error voting:",U);let e="Failed to record vote";409===(null===(P=U.response)||void 0===P?void 0:P.status)?e="You have already voted. Please refresh the page.":401===(null===(F=U.response)||void 0===F?void 0:F.status)?e="Please log in again to vote":403===(null===(L=U.response)||void 0===L?void 0:L.status)?e="You do not have permission to vote on this item":null!==(B=U.response)&&void 0!==B&&null!==(V=B.data)&&void 0!==V&&V.message?e=U.response.data.message:U.message&&"Network Error"!==U.message&&(e=U.message),f(s),j(r),w(o),(0,n.Ni)(e,4e3)}finally{A(!1)}},M=()=>b-k,D=()=>{const e=M();return e>0?"text-green-600 dark:text-green-400":e<0?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400"};return"vertical"===v?(0,l.jsxs)("div",{className:"flex flex-col items-center space-y-1",children:[(0,l.jsx)("button",{onClick:()=>C("upvote"),disabled:N,className:"".concat(S[x]," rounded transition-all duration-200 flex items-center justify-center touch-manipulation ").concat("upvote"===_?"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400 transform scale-110":"text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-green-600 dark:hover:text-green-400 active:scale-95"," ").concat(N?"opacity-50 cursor-not-allowed":""),style:{WebkitTapHighlightColor:"rgba(34, 197, 94, 0.1)"},children:"\ud83d\udc4d"}),(0,l.jsx)("span",{className:"text-xs font-medium ".concat(D()),children:M()}),(0,l.jsx)("button",{onClick:()=>C("downvote"),disabled:N,className:"".concat(S[x]," rounded transition-all duration-200 flex items-center justify-center touch-manipulation ").concat("downvote"===_?"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400 transform scale-110":"text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-red-600 dark:hover:text-red-400 active:scale-95"," ").concat(N?"opacity-50 cursor-not-allowed":""),style:{WebkitTapHighlightColor:"rgba(239, 68, 68, 0.1)"},children:"\ud83d\udc4e"})]}):(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsxs)("button",{onClick:()=>C("upvote"),disabled:N,className:"".concat(S[x]," rounded transition-all duration-200 flex items-center justify-center space-x-1 touch-manipulation ").concat("upvote"===_?"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400 transform scale-105":"text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-green-600 dark:hover:text-green-400 active:scale-95"," ").concat(N?"opacity-50 cursor-not-allowed":""),style:{WebkitTapHighlightColor:"rgba(34, 197, 94, 0.1)"},children:[(0,l.jsx)("span",{children:"\ud83d\udc4d"}),(0,l.jsx)("span",{className:"text-xs font-medium",children:b})]}),(0,l.jsxs)("button",{onClick:()=>C("downvote"),disabled:N,className:"".concat(S[x]," rounded transition-all duration-200 flex items-center justify-center space-x-1 touch-manipulation ").concat("downvote"===_?"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400 transform scale-105":"text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-red-600 dark:hover:text-red-400 active:scale-95"," ").concat(N?"opacity-50 cursor-not-allowed":""),style:{WebkitTapHighlightColor:"rgba(239, 68, 68, 0.1)"},children:[(0,l.jsx)("span",{children:"\ud83d\udc4e"}),(0,l.jsx)("span",{className:"text-xs font-medium",children:k})]})]})}}}]);