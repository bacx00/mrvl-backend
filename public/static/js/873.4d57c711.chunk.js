"use strict";(self.webpackChunkmrvl_frontend=self.webpackChunkmrvl_frontend||[]).push([[873],{7873:(e,a,t)=>{t.r(a),t.d(a,{default:()=>n});var s=t(2555),l=t(9950),r=t(5150),d=t(4414);const n=function(e){let{threadId:a,navigateTo:t,params:n}=e;const{api:i,user:c}=(0,r.As)(),[o,h]=(0,l.useState)({title:"",content:"",category_id:"",pinned:!1,locked:!1,sticky:!1}),[m,u]=(0,l.useState)([]),[x,p]=(0,l.useState)(!1),[y,v]=(0,l.useState)(!1),g=Boolean(a||(null===n||void 0===n?void 0:n.editId)),b=a||(null===n||void 0===n?void 0:n.editId);(0,l.useEffect)((()=>{f(),g&&b&&k()}),[b]);const f=async()=>{try{var e;const a=await i.get("/forums/categories"),t=(null===a||void 0===a||null===(e=a.data)||void 0===e?void 0:e.data)||(null===a||void 0===a?void 0:a.data)||[];u(Array.isArray(t)?t:[]),!g&&t.length>0&&h((e=>(0,s.A)((0,s.A)({},e),{},{category_id:t[0].id})))}catch(a){console.error("Error fetching categories:",a),u([])}},k=async()=>{try{var e,a;p(!0);const t=await i.get("/forums/threads/".concat(b)),s=(null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.data)||(null===t||void 0===t?void 0:t.data)||{};h({title:s.title||"",content:s.content||"",category_id:(null===(a=s.category)||void 0===a?void 0:a.id)||s.category_id||"",pinned:s.pinned||!1,locked:s.locked||!1,sticky:s.sticky||!1})}catch(t){console.error("Error fetching thread:",t),alert("Failed to load thread data")}finally{p(!1)}};return x?(0,d.jsx)("div",{className:"p-6",children:(0,d.jsx)("div",{className:"text-center py-8",children:"Loading thread data..."})}):(0,d.jsxs)("div",{className:"p-6 max-w-4xl mx-auto",children:[(0,d.jsx)("div",{className:"mb-6",children:(0,d.jsx)("h2",{className:"text-2xl font-bold",children:g?"Edit Thread":"Create New Thread"})}),(0,d.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:(0,d.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),o.title.trim())if(o.content.trim())if(o.category_id){v(!0);try{const e={title:o.title.trim(),content:o.content.trim(),category_id:o.category_id,pinned:o.pinned,locked:o.locked,sticky:o.sticky};if(g)await i.put("/admin/forums/".concat(b),e),alert("Thread updated successfully!");else{var a,l,r;const d=await i.post("/forums/threads",(0,s.A)((0,s.A)({},e),{},{user_id:null===c||void 0===c?void 0:c.id}));alert("Thread created successfully!");const n=(null===d||void 0===d||null===(a=d.data)||void 0===a||null===(l=a.data)||void 0===l?void 0:l.id)||(null===d||void 0===d||null===(r=d.data)||void 0===r?void 0:r.id);if(n)return void t("thread-detail",{id:n})}t("admin-forums")}catch(h){var d,n;console.error("Error saving thread:",h);const e=(null===(d=h.response)||void 0===d||null===(n=d.data)||void 0===n?void 0:n.message)||"Failed to save thread";alert(e)}finally{v(!1)}}else alert("Please select a category");else alert("Content is required");else alert("Title is required")},children:[(0,d.jsxs)("div",{className:"mb-4",children:[(0,d.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["Title ",(0,d.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,d.jsx)("input",{type:"text",value:o.title,onChange:e=>h((0,s.A)((0,s.A)({},o),{},{title:e.target.value})),className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",placeholder:"Enter thread title...",required:!0})]}),(0,d.jsxs)("div",{className:"mb-4",children:[(0,d.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["Category ",(0,d.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,d.jsxs)("select",{value:o.category_id,onChange:e=>h((0,s.A)((0,s.A)({},o),{},{category_id:e.target.value})),className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",required:!0,children:[(0,d.jsx)("option",{value:"",children:"Select a category"}),m.map((e=>(0,d.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,d.jsxs)("div",{className:"mb-4",children:[(0,d.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["Content ",(0,d.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,d.jsx)("textarea",{value:o.content,onChange:e=>h((0,s.A)((0,s.A)({},o),{},{content:e.target.value})),className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600",rows:"12",placeholder:"Enter thread content...",required:!0}),(0,d.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"You can use @username to mention users, @team:teamname for teams, and @player:playername for players"})]}),(0,d.jsxs)("div",{className:"mb-6",children:[(0,d.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Thread Options"}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsxs)("label",{className:"flex items-center",children:[(0,d.jsx)("input",{type:"checkbox",checked:o.pinned,onChange:e=>h((0,s.A)((0,s.A)({},o),{},{pinned:e.target.checked})),className:"mr-2"}),(0,d.jsx)("span",{children:"Pin this thread (appears at the top of the category)"})]}),(0,d.jsxs)("label",{className:"flex items-center",children:[(0,d.jsx)("input",{type:"checkbox",checked:o.sticky,onChange:e=>h((0,s.A)((0,s.A)({},o),{},{sticky:e.target.checked})),className:"mr-2"}),(0,d.jsx)("span",{children:"Make sticky (stays at the top even when not recent)"})]}),(0,d.jsxs)("label",{className:"flex items-center",children:[(0,d.jsx)("input",{type:"checkbox",checked:o.locked,onChange:e=>h((0,s.A)((0,s.A)({},o),{},{locked:e.target.checked})),className:"mr-2"}),(0,d.jsx)("span",{children:"Lock this thread (no new replies allowed)"})]})]})]}),(0,d.jsxs)("div",{className:"flex gap-3",children:[(0,d.jsx)("button",{type:"submit",disabled:y,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:y?"Saving...":g?"Update Thread":"Create Thread"}),(0,d.jsx)("button",{type:"button",onClick:()=>{window.confirm("Are you sure you want to cancel? Any unsaved changes will be lost.")&&t("admin-forums")},className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Cancel"})]})]})})]})}}}]);