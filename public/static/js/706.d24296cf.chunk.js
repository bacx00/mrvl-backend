"use strict";(self.webpackChunkmrvl_frontend=self.webpackChunkmrvl_frontend||[]).push([[706],{8067:(e,t,o)=>{o.d(t,{A:()=>n});var s=o(9950),a=o(5150),r=o(4414);const n=function(e){let{itemType:t,itemId:o,initialUpvotes:n=0,initialDownvotes:d=0,userVote:l=null,onVoteChange:i=null,size:c="sm",direction:u="horizontal"}=e;const{api:v,user:m,isAuthenticated:x}=(0,a.As)(),[p,h]=(0,s.useState)(n),[g,y]=(0,s.useState)(d),[b,f]=(0,s.useState)(l),[w,k]=(0,s.useState)(!1),[j,N]=(0,s.useState)(!1),_=(0,s.useRef)(!1),A={xs:"p-1 text-xs min-h-[36px] min-w-[36px]",sm:"p-1.5 text-sm min-h-[40px] min-w-[40px]",md:"p-2 text-base min-h-[44px] min-w-[44px]",lg:"p-3 text-lg min-h-[48px] min-w-[48px]"},C=(0,s.useCallback)((async()=>{if("post"!==t&&"match-comment"!==t){if(x&&"thread"===t)try{var e;const t="/forums/threads/".concat(o),r=await v.get(t),l=(null===(e=r.data)||void 0===e?void 0:e.data)||r.data;if(l){var s,a;if(!_.current)h((null===(s=l.stats)||void 0===s?void 0:s.upvotes)||l.upvotes||n),y((null===(a=l.stats)||void 0===a?void 0:a.downvotes)||l.downvotes||d),f(l.user_vote||null);N(!0)}}catch(r){console.warn("Could not fetch thread vote state:",r),N(!0)}}else N(!0)}),[v,t,o,x,n,d]);(0,s.useEffect)((()=>{C()}),[C]),(0,s.useEffect)((()=>{const e=()=>{console.log("Connection restored - refreshing vote state"),N(!1),_.current=!1,C()};return window.addEventListener("online",e),()=>{window.removeEventListener("online",e)}}),[C]);const S=(0,s.useRef)(o),[T,F]=(0,s.useState)(!1);(0,s.useEffect)((()=>{if(S.current!==o)h(n),y(d),f(l),N(!1),_.current=!1,S.current=o,F(!0);else if(T){if(!_.current&&(p!==n||g!==d))return}else h(n),y(d),f(l),F(!0)}),[o,n,d,l,T]),(0,s.useEffect)((()=>{console.log("ForumVotingButtons state: itemId=".concat(o,", upvotes=").concat(p,", downvotes=").concat(g,", currentVote=").concat(b,", hasVoted=").concat(_.current))}),[p,g,b,o]);const P=async e=>{if(!x)return void alert("Please log in to vote");if(w)return;k(!0);const s=p,a=g,r=b,n=document.querySelector('[data-vote-type="'.concat(e,'"]'));n&&n.classList.add("animate-pulse");try{let n;if("thread"===t)n="/forums/threads/".concat(o,"/vote");else if("post"===t)n="/forums/posts/".concat(o,"/vote");else{if("match-comment"!==t)throw new Error("Unknown item type: ".concat(t));n="/match-comments/".concat(o,"/vote")}const l=b===e,c={vote_type:e},u=await v.post(n,c);if(console.log("Forum vote raw response:",u),!1!==(null===u||void 0===u?void 0:u.success)){const t=(null===u||void 0===u?void 0:u.vote_counts)||(null===u||void 0===u?void 0:u.updated_stats)||(null===u||void 0===u?void 0:u.stats),o=null===u||void 0===u?void 0:u.user_vote,n=(null===u||void 0===u?void 0:u.action)||"voted";if(console.log("Extracted from response:",{serverCounts:t,serverUserVote:o,action:n}),_.current=!0,t&&"object"===typeof t){const e=parseInt(t.upvotes)||0,o=parseInt(t.downvotes)||0;console.log("Vote response - Setting counts: upvotes=".concat(e,", downvotes=").concat(o)),h(e),y(o)}else console.warn("No valid server counts in response, response was:",u),"removed"===n?("upvote"===r?h(Math.max(0,s-1)):"downvote"===r&&y(Math.max(0,a-1)),f(null)):"updated"!==n&&"voted"!==n||(l?("upvote"===e?h(Math.max(0,s-1)):y(Math.max(0,a-1)),f(null)):r?("upvote"===e?(h(s+1),y(Math.max(0,a-1))):(y(a+1),h(Math.max(0,s-1))),f(e)):("upvote"===e?h(s+1):y(a+1),f(e)));if(f(void 0!==o?o:"removed"===n?null:e),i){const e=t||{upvotes:(null===t||void 0===t?void 0:t.upvotes)||p,downvotes:(null===t||void 0===t?void 0:t.downvotes)||g,score:((null===t||void 0===t?void 0:t.upvotes)||p)-((null===t||void 0===t?void 0:t.downvotes)||g)};i({action:n,vote_counts:e,user_vote:void 0!==o?o:b})}}else{var d;const e=(null===(d=u.data)||void 0===d?void 0:d.message)||"Vote request failed";console.warn("Vote request unsuccessful:",e),alert(e)}}catch(A){var l;if(console.error("Vote request error:",A),409===(null===(l=A.response)||void 0===l?void 0:l.status))return;{var c,u,m;let e="Failed to record vote";if(401===(null===(c=A.response)||void 0===c?void 0:c.status))e="Please log in to vote";else if(403===(null===(u=A.response)||void 0===u?void 0:u.status))e="You do not have permission to vote on this item";else if(404===(null===(m=A.response)||void 0===m?void 0:m.status))e="This item no longer exists or has been deleted";else{var j,N;const t=(null===(j=A.response)||void 0===j||null===(N=j.data)||void 0===N?void 0:N.message)||A.message;t&&"string"===typeof t&&(e=t)}alert(e)}}finally{k(!1);const t=document.querySelector('[data-vote-type="'.concat(e,'"]'));t&&t.classList.remove("animate-pulse")}},D=()=>p-g,E=()=>{const e=D();return e>0?"text-green-600 dark:text-green-400":e<0?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400"};return"vertical"===u?(0,r.jsxs)("div",{className:"flex flex-col items-center space-y-1",children:[(0,r.jsx)("button",{onClick:()=>P("upvote"),disabled:w,"data-vote-type":"upvote",className:"".concat(A[c]," rounded transition-all duration-200 flex items-center justify-center touch-manipulation ").concat("upvote"===b?"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400 transform scale-110 shadow-lg":"text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-green-600 dark:hover:text-green-400 active:scale-95"," ").concat(w?"opacity-50 cursor-not-allowed":"hover:shadow-md"),style:{WebkitTapHighlightColor:"rgba(34, 197, 94, 0.1)"},title:"Upvote",children:(0,r.jsx)("span",{children:"\ud83d\udc4d"})}),(0,r.jsx)("span",{className:"text-xs font-medium ".concat(E()),children:D()}),(0,r.jsx)("button",{onClick:()=>P("downvote"),disabled:w,"data-vote-type":"downvote",className:"".concat(A[c]," rounded transition-all duration-200 flex items-center justify-center touch-manipulation ").concat("downvote"===b?"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400 transform scale-110 shadow-lg":"text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-red-600 dark:hover:text-red-400 active:scale-95"," ").concat(w?"opacity-50 cursor-not-allowed":"hover:shadow-md"),style:{WebkitTapHighlightColor:"rgba(239, 68, 68, 0.1)"},title:"Downvote",children:(0,r.jsx)("span",{children:"\ud83d\udc4e"})})]}):(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)("button",{onClick:()=>P("upvote"),disabled:w,"data-vote-type":"upvote",className:"".concat(A[c]," rounded transition-all duration-200 flex items-center justify-center space-x-1 touch-manipulation ").concat("upvote"===b?"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400 transform scale-105 shadow-lg":"text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-green-600 dark:hover:text-green-400 active:scale-95"," ").concat(w?"opacity-50 cursor-not-allowed":"hover:shadow-md"),style:{WebkitTapHighlightColor:"rgba(34, 197, 94, 0.1)"},title:"Upvote",children:[(0,r.jsx)("span",{children:"\ud83d\udc4d"}),(0,r.jsx)("span",{className:"text-xs font-medium",children:p})]}),"xs"!==c&&(0,r.jsx)("span",{className:"text-xs font-medium px-2 ".concat(E()),children:D()>0?"+".concat(D()):D()}),(0,r.jsxs)("button",{onClick:()=>P("downvote"),disabled:w,"data-vote-type":"downvote",className:"".concat(A[c]," rounded transition-all duration-200 flex items-center justify-center space-x-1 touch-manipulation ").concat("downvote"===b?"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400 transform scale-105 shadow-lg":"text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-red-600 dark:hover:text-red-400 active:scale-95"," ").concat(w?"opacity-50 cursor-not-allowed":"hover:shadow-md"),style:{WebkitTapHighlightColor:"rgba(239, 68, 68, 0.1)"},title:"Downvote",children:[(0,r.jsx)("span",{children:"\ud83d\udc4e"}),(0,r.jsx)("span",{className:"text-xs font-medium",children:g})]})]})}},8706:(e,t,o)=>{o.r(t),o.d(t,{default:()=>v});var s=o(2555),a=o(9950),r=o(5150),n=o(1453),d=o(8067),l=o(4085),i=o(1368),c=o(4414);var u=o(1990);const v=function(e){var t,o,v,m,x,p,h,g,y,b,f,w,k,j,N;let{params:_,navigateTo:A}=e;const C=null===_||void 0===_?void 0:_.id,{isAuthenticated:S,isAdmin:T,isModerator:F,api:P,user:D}=(0,r.As)(),[E,V]=(0,a.useState)(null),[z,M]=(0,a.useState)([]),[U,I]=(0,a.useState)(!0),[R,L]=(0,a.useState)(""),[q,W]=(0,a.useState)(null),[H,Y]=(0,a.useState)(!1),[J,B]=(0,a.useState)(null),[O,K]=(0,a.useState)(""),[G,Q]=(0,a.useState)(!1),[X,Z]=(0,a.useState)(1),[$,ee]=(0,a.useState)(!1),[te,oe]=(0,a.useState)(!1),se=e=>"string"===typeof e?e:null===e||void 0===e?"":"object"===typeof e?e.message?e.message:e.error&&"string"===typeof e.error?e.error:e.content?String(e.content):"":String(e),ae=(0,a.useCallback)((async()=>{try{var e;I(!0);const t=(new Date).getTime(),o=await P.get("/forums/threads/".concat(C,"?t=").concat(t),{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}}),s=(null===(e=o.data)||void 0===e?void 0:e.data)||o.data,a=s.posts||[];if(!s||!s.id)return console.error("\u274c Invalid thread data received for thread ".concat(C)),V(null),void M([]);V(s),M(a),ee(a.length>=20)}catch(s){var t,o;console.error("\u274c ThreadDetailPage: Backend API failed:",s),404===(null===(t=s.response)||void 0===t?void 0:t.status)?console.error("\u274c Thread ".concat(C," not found (404)")):403===(null===(o=s.response)||void 0===o?void 0:o.status)&&console.error("\u274c Access denied to thread ".concat(C," (403)")),V(null),M([])}finally{I(!1)}}),[P,C]);(0,a.useEffect)((()=>{ae()}),[ae]);const re=e=>{if(!e)return"Unknown";const t=new Date(e);if(isNaN(t.getTime()))return"Unknown";const o=new Date,s=Math.floor((o-t)/36e5);if(s<1)return"Just now";if(s<24)return"".concat(s,"h");if(s<48)return"Yesterday";const a=Math.floor(s/24);if(a<30)return"".concat(a,"d");const r=Math.floor(a/30);if(r<12)return"".concat(r,"mo");const n=Math.floor(r/12);return"".concat(n,"y")},ne=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const o=se(e);if(!o||"string"!==typeof o)return null;const a={};if(Array.isArray(t)&&t.forEach((e=>{if("object"===typeof e&&null!==e){const t=se(e.mention_text);t&&(a[t]=(0,s.A)((0,s.A)({},e),{},{type:se(e.type)||"user",id:e.id||"",name:se(e.name)||"",display_name:se(e.display_name)||se(e.name)||"",username:se(e.username)||"",team_name:se(e.team_name)||"",player_name:se(e.player_name)||""}))}else{const t=se(e);t&&(a[t]={mention_text:t,type:"user",id:"",name:t,display_name:t})}})),!t||0===t.length)return o;const r=[...t].sort(((e,t)=>(e.position_start||0)-(t.position_start||0))),n=[];let d=0;return r.forEach((e=>{const t=e.mention_text,s=o.indexOf(t,d);-1!==s&&(s>d&&n.push(o.slice(d,s)),n.push((0,c.jsx)(i.A,{mention:e,navigateTo:A},"mention-".concat(s,"-").concat(e.id))),d=s+t.length)})),d<o.length&&n.push(o.slice(d)),n.length>0?n:o},de=async e=>{e.preventDefault();const t=se(R);if(!t.trim()||H)return;if(null!==q&&void 0!==q&&q.id&&q.id.toString().startsWith("temp-"))return void alert("Please wait for the post to be created before replying to it.");const o=[...z];try{var a;Y(!0);const e={id:"temp-".concat(Date.now()),content:se(t.trim()),author:(0,s.A)((0,s.A)({},D),{},{name:se(null===D||void 0===D?void 0:D.name),username:se(null===D||void 0===D?void 0:D.username),email:se(null===D||void 0===D?void 0:D.email),id:(null===D||void 0===D?void 0:D.id)||null,avatar_url:se(null===D||void 0===D?void 0:D.avatar_url)}),meta:{created_at:(new Date).toISOString()},is_temp:!0,upvotes:0,downvotes:0,user_vote:null,mentions:[],stats:{upvotes:0,downvotes:0},replies:[]};M(q?t=>t.map((t=>t.id===q.id?(0,s.A)((0,s.A)({},t),{},{replies:[...t.replies||[],e]}):t)):t=>[...t,e]);const u={content:se(t.trim()),parent_id:(null===q||void 0===q?void 0:q.id)||null},m=await P.post("/user/forums/threads/".concat(C,"/posts"),u);if(201===m.status||!0===(null===(a=m.data)||void 0===a?void 0:a.success)||m.data&&!m.data.error&&m.data.post){L(""),W(null);const t=m.data.post||m.data.data||m.data;if(t&&(se(t.content)||t.id)){var r,n,d,l,i;const o=(0,s.A)((0,s.A)({},t),{},{content:se(t.content),author:(0,s.A)((0,s.A)({},t.author),{},{name:se(null===(r=t.author)||void 0===r?void 0:r.name),username:se(null===(n=t.author)||void 0===n?void 0:n.username),id:(null===(d=t.author)||void 0===d?void 0:d.id)||null,email:se(null===(l=t.author)||void 0===l?void 0:l.email),avatar_url:se(null===(i=t.author)||void 0===i?void 0:i.avatar_url)}),mentions:Array.isArray(t.mentions)?t.mentions.map((e=>"object"===typeof e&&null!==e?(0,s.A)((0,s.A)({},e),{},{mention_text:se(e.mention_text),name:se(e.name),display_name:se(e.display_name),type:se(e.type),id:e.id||null,username:se(e.username),team_name:se(e.team_name),player_name:se(e.player_name)}):{mention_text:se(e),name:se(e),display_name:se(e),type:"user",id:null})):[],meta:t.meta||{},stats:t.stats||{},upvotes:t.upvotes||0,downvotes:t.downvotes||0,user_vote:t.user_vote||null,replies:Array.isArray(t.replies)?t.replies:[]});M(q?t=>t.map((t=>t.id===q.id?(0,s.A)((0,s.A)({},t),{},{replies:t.replies.map((t=>t.id===e.id?o:t))}):t)):t=>t.map((t=>t.id===e.id?o:t)))}else await ae();const o=document.createElement("div");o.textContent="\u2705 Reply posted successfully",o.className="fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded shadow-lg z-50",document.body.appendChild(o),setTimeout((()=>document.body.removeChild(o)),3e3)}else{var c,v;M(o),console.error("\u274c Reply submission failed:",m.data);const e=(null===(c=m.data)||void 0===c?void 0:c.message)||(null===(v=m.data)||void 0===v?void 0:v.error)||"Failed to submit reply. Please try again.";alert(e)}}catch(p){var m,x;console.error("\u274c Failed to submit reply:",p),M(o);let e="Failed to submit reply. Please try again.";const t=(0,u.Jo)(p);t.includes("Thread is locked")?(e="This thread is locked and no longer accepts replies.",await ae()):t.includes("parent id is invalid")?(e="The post you are replying to no longer exists. The page will refresh.",await ae()):t.includes("401")||401===(null===(m=p.response)||void 0===m?void 0:m.status)?e="Please log in again to post replies.":t.includes("403")||403===(null===(x=p.response)||void 0===x?void 0:x.status)?e="You do not have permission to reply to this thread.":"An unknown error occurred"!==t&&(e=t),alert(e)}finally{Y(!1)}},le=function(e){var t,o,a,r,i,v,m,x,p;let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const y=e.replies&&e.replies.length>0&&g<3,b=h?{marginLeft:"".concat(Math.min(2*g,6),"rem")}:{};return(0,c.jsx)("div",{className:"".concat(h?"pl-4 border-l-2 border-gray-200 dark:border-gray-700":""," py-4 ").concat(g>0?"bg-gray-50/50 dark:bg-gray-800/50 rounded-lg":""),style:b,children:(0,c.jsxs)("div",{className:"w-full",children:[(0,c.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,c.jsx)(n.A,{user:e.author,showAvatar:!0,showHeroFlair:!0,showTeamFlair:!0,size:"sm",clickable:!1}),(0,c.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-500",children:re((null===(t=e.meta)||void 0===t?void 0:t.created_at)||e.created_at)}),e.is_temp&&(0,c.jsxs)("span",{className:"text-xs text-blue-500 dark:text-blue-400 flex items-center",children:[(0,c.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse mr-1"}),"Posting..."]}),e.is_edited&&!e.is_temp&&(0,c.jsxs)("span",{className:"text-xs text-gray-400 dark:text-gray-600",children:["(edited ",re((null===(o=e.meta)||void 0===o?void 0:o.updated_at)||e.edited_at),")"]}),!e.is_temp&&(0,c.jsx)(d.A,{itemType:"post",itemId:e.id,initialUpvotes:void 0!==(null===(a=e.stats)||void 0===a?void 0:a.upvotes)?e.stats.upvotes:e.upvotes||0,initialDownvotes:void 0!==(null===(r=e.stats)||void 0===r?void 0:r.downvotes)?e.stats.downvotes:e.downvotes||0,userVote:e.user_vote,direction:"horizontal",size:"xs",onVoteChange:t=>{M((o=>o.map((o=>{var a,r,n,d,l,i;return o.id===e.id?(0,s.A)((0,s.A)({},o),{},{stats:(0,s.A)((0,s.A)({},o.stats),{},{upvotes:(null===(a=t.vote_counts)||void 0===a?void 0:a.upvotes)||(null===(r=o.stats)||void 0===r?void 0:r.upvotes)||0,downvotes:(null===(n=t.vote_counts)||void 0===n?void 0:n.downvotes)||(null===(d=o.stats)||void 0===d?void 0:d.downvotes)||0}),upvotes:(null===(l=t.vote_counts)||void 0===l?void 0:l.upvotes)||o.upvotes||0,downvotes:(null===(i=t.vote_counts)||void 0===i?void 0:i.downvotes)||o.downvotes||0,user_vote:t.user_vote}):o}))))}})]}),(0,c.jsx)("div",{className:"prose prose-sm dark:prose-invert max-w-none mb-4",children:(0,u.Vm)(e.content).split("\n").map(((t,o)=>(0,c.jsx)("p",{className:"mb-2 last:mb-0",children:ne(se(t),e.mentions||[])},o)))}),(0,c.jsxs)("div",{className:"flex items-center space-x-4 mb-3",children:[S&&!e.is_temp&&!(null!==(i=E.meta)&&void 0!==i&&i.locked)&&(0,c.jsx)("button",{onClick:()=>W(e),className:"text-xs text-gray-500 dark:text-gray-500 hover:text-red-600 dark:hover:text-red-400 transition-colors",children:"Reply"}),((null===(v=e.author)||void 0===v?void 0:v.id)===(null===D||void 0===D?void 0:D.id)||T()||F())&&(0,c.jsx)("button",{onClick:()=>(e=>{B(e),K(e.content)})(e),className:"text-xs text-gray-500 dark:text-gray-500 hover:text-red-600 dark:hover:text-red-400 transition-colors",children:"Edit"}),((null===(m=e.author)||void 0===m?void 0:m.id)===(null===D||void 0===D?void 0:D.id)||T()||F())&&(0,c.jsx)("button",{onClick:()=>(async e=>{if(!window.confirm("Are you sure you want to delete this post?"))return;const t=[...z];try{var o;Y(!0);const a=z.map((t=>{if(t.id===e)return null;if(t.replies&&t.replies.length>0){const o=t.replies.filter((t=>t.id!==e));return(0,s.A)((0,s.A)({},t),{},{replies:o})}return t})).filter((e=>null!==e));M(a);const r=await P.delete("/user/forums/posts/".concat(e));if(null!==(o=r.data)&&void 0!==o&&o.success||r.success){console.log("\u2705 Post deleted successfully");const e=document.createElement("div");e.textContent="\u2705 Post deleted successfully",e.className="fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded shadow-lg z-50",document.body.appendChild(e),setTimeout((()=>document.body.removeChild(e)),3e3)}else console.warn("\u26a0\ufe0f Delete request did not return success, rolling back"),M(t),alert("Failed to delete post. Please try again.")}catch(d){var a,r,n;console.error("\u274c Failed to delete post:",d),M(t);let e="Failed to delete post. Please try again.";const o=(0,u.Jo)(d);o.includes("403")||403===(null===(a=d.response)||void 0===a?void 0:a.status)?e="You do not have permission to delete this post.":o.includes("404")||404===(null===(r=d.response)||void 0===r?void 0:r.status)?e="Post not found or already deleted.":o.includes("401")||401===(null===(n=d.response)||void 0===n?void 0:n.status)?e="Please log in again to delete posts.":"An unknown error occurred"!==o&&(e=o),alert(e)}finally{Y(!1)}})(e.id),disabled:H,className:"text-xs transition-colors ".concat(H?"text-gray-400 dark:text-gray-600 cursor-not-allowed":"text-gray-500 dark:text-gray-500 hover:text-red-600 dark:hover:text-red-400"),children:H?"Deleting...":"Delete"})]}),(null===q||void 0===q?void 0:q.id)===e.id&&(0,c.jsx)("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded",children:(0,c.jsxs)("form",{onSubmit:de,children:[(0,c.jsxs)("div",{className:"mb-2",children:[(0,c.jsxs)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Replying to @",(null===(x=e.author)||void 0===x?void 0:x.username)||(null===(p=e.author)||void 0===p?void 0:p.name)]}),(0,c.jsx)("button",{type:"button",onClick:()=>W(null),className:"ml-2 text-xs text-red-600 dark:text-red-400 hover:underline",children:"Cancel"})]}),(0,c.jsx)(l.A,{value:R,onChange:e=>{L(e)},placeholder:"Write your reply... (Type @ to mention teams and players)",rows:3,className:"w-full border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white resize-none focus:ring-2 focus:ring-red-500 dark:focus:ring-red-400 focus:border-transparent"}),(0,c.jsxs)("div",{className:"flex justify-end space-x-2 mt-2",children:[(0,c.jsx)("button",{type:"button",onClick:()=>W(null),className:"px-3 py-1 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors",children:"Cancel"}),(0,c.jsx)("button",{type:"submit",disabled:!se(R).trim()||H,className:"px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:H?"Posting...":"Reply"})]})]})}),(null===J||void 0===J?void 0:J.id)===e.id&&(0,c.jsx)("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded border border-blue-200 dark:border-blue-700",children:(0,c.jsxs)("form",{onSubmit:t=>{t.preventDefault(),(async e=>{const t=se(O);if(t.trim())try{var o;Y(!0),null!==(o=(await P.put("/user/forums/posts/".concat(e),{content:t.trim()})).data)&&void 0!==o&&o.success?(B(null),K(""),await ae()):alert("Failed to edit post. Please try again.")}catch(s){console.error("\u274c Failed to edit post:",s),alert("Failed to edit post. Please try again.")}finally{Y(!1)}})(e.id)},children:[(0,c.jsxs)("div",{className:"mb-2",children:[(0,c.jsx)("span",{className:"text-sm text-blue-600 dark:text-blue-400 font-medium",children:"Editing post"}),(0,c.jsx)("button",{type:"button",onClick:()=>{B(null),K("")},className:"ml-2 text-xs text-red-600 dark:text-red-400 hover:underline",children:"Cancel"})]}),(0,c.jsx)("textarea",{value:O,onChange:e=>{var t;const o="string"===typeof e?e:(null===(t=e.target)||void 0===t?void 0:t.value)||"";K(o)},placeholder:"Edit your post...",rows:4,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white resize-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent"}),(0,c.jsxs)("div",{className:"flex justify-end space-x-2 mt-2",children:[(0,c.jsx)("button",{type:"button",onClick:()=>{B(null),K("")},className:"px-3 py-1 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors",children:"Cancel"}),(0,c.jsx)("button",{type:"submit",disabled:!se(O).trim()||H,className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:H?"Saving...":"Save Changes"})]})]})}),y&&(0,c.jsx)("div",{className:"mt-4 space-y-2",children:e.replies.map((e=>le(e,!0,g+1)))}),e.replies&&e.replies.length>0&&g>=3&&(0,c.jsx)("div",{className:"mt-3 ml-4",children:(0,c.jsxs)("button",{className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:["View ",e.replies.length," more ",1===e.replies.length?"reply":"replies","..."]})})]})},e.id)};return U?(0,c.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,c.jsxs)("div",{className:"text-center py-8",children:[(0,c.jsx)("div",{className:"text-2xl mb-4",children:"\ud83d\udcac"}),(0,c.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading post..."})]})}):E?(0,c.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,c.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400 mb-4",children:[(0,c.jsx)("button",{onClick:()=>A&&A("forums"),className:"hover:text-red-600 dark:hover:text-red-400 transition-colors",children:"Forums"}),(0,c.jsx)("span",{children:"/"}),(0,c.jsxs)("span",{className:"px-2 py-0.5 text-xs font-bold rounded-full text-white",style:{backgroundColor:(null===(t=E.category)||void 0===t?void 0:t.color)||"#6b7280"},children:[null===(o=E.category)||void 0===o?void 0:o.icon," ",null===(v=E.category)||void 0===v?void 0:v.name]}),(0,c.jsx)("span",{children:"/"}),(0,c.jsx)("span",{className:"text-gray-900 dark:text-white font-medium truncate",children:E.title})]}),(0,c.jsx)("div",{className:"card p-6 mb-6",children:(0,c.jsx)("div",{className:"flex space-x-4",children:(0,c.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,c.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(null===(m=E.meta)||void 0===m?void 0:m.pinned)&&(0,c.jsx)("span",{className:"px-2 py-1 text-xs font-bold rounded bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-300",children:"\ud83d\udccc PINNED"}),(null===(x=E.meta)||void 0===x?void 0:x.locked)&&(0,c.jsx)("span",{className:"px-2 py-1 text-xs font-bold rounded bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300",children:"\ud83d\udd12 LOCKED"})]}),(0,c.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-3",children:E.title}),(0,c.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,c.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,c.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-500",children:"Started by"}),(0,c.jsx)(n.A,{user:E.author,showAvatar:!0,showHeroFlair:!0,showTeamFlair:!0,size:"sm",clickable:!1}),(0,c.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-500",children:re((null===(p=E.meta)||void 0===p?void 0:p.created_at)||E.created_at)}),(0,c.jsx)(d.A,{itemType:"thread",itemId:E.id,initialUpvotes:(null===(h=E.stats)||void 0===h?void 0:h.upvotes)||0,initialDownvotes:(null===(g=E.stats)||void 0===g?void 0:g.downvotes)||0,userVote:E.user_vote,direction:"horizontal",size:"xs",onVoteChange:e=>{V((t=>{var o,a,r,n,d,l;return(0,s.A)((0,s.A)({},t),{},{stats:(0,s.A)((0,s.A)({},t.stats),{},{upvotes:(null===(o=e.vote_counts)||void 0===o?void 0:o.upvotes)||(null===(a=t.stats)||void 0===a?void 0:a.upvotes)||0,downvotes:(null===(r=e.vote_counts)||void 0===r?void 0:r.downvotes)||(null===(n=t.stats)||void 0===n?void 0:n.downvotes)||0}),upvotes:(null===(d=e.vote_counts)||void 0===d?void 0:d.upvotes)||t.upvotes||0,downvotes:(null===(l=e.vote_counts)||void 0===l?void 0:l.downvotes)||t.downvotes||0,user_vote:e.user_vote})}))}})]}),(0,c.jsx)("div",{className:"flex items-center space-x-6 text-sm text-gray-600 dark:text-gray-400",children:(0,c.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,c.jsx)("span",{className:"font-medium",children:z.length}),(0,c.jsx)("span",{children:"replies"})]})})]}),E.content&&(0,c.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:(0,c.jsx)("div",{className:"prose prose-sm dark:prose-invert max-w-none",children:se(E.content).split("\n").map(((e,t)=>(0,c.jsx)("p",{className:"mb-2 last:mb-0",children:ne(se(e),E.mentions||[])},t)))})}),(T()||F())&&(0,c.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:(0,c.jsxs)("div",{className:"flex items-center space-x-3 flex-wrap",children:[(0,c.jsx)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Admin:"}),(0,c.jsx)("button",{onClick:()=>(async()=>{try{var e,t,o,s;const a=null===(e=E.meta)||void 0===e?void 0:e.pinned,r="/admin/forums/threads/".concat(C,a?"/unpin":"/pin"),n=await P.post(r);null!==(t=n.data)&&void 0!==t&&t.success||null!==(o=n.data)&&void 0!==o&&null!==(s=o.message)&&void 0!==s&&s.includes("successfully")?await ae():alert("Failed to update thread pin status")}catch(a){console.error("\u274c Failed to pin/unpin thread:",a),alert("Failed to update thread pin status")}})(),className:"px-3 py-1 text-xs rounded ".concat(null!==(y=E.meta)&&void 0!==y&&y.pinned?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-300":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300"," hover:opacity-80 transition-opacity"),children:null!==(b=E.meta)&&void 0!==b&&b.pinned?"\ud83d\udccc Unpin":"\ud83d\udccc Pin"}),(0,c.jsx)("button",{onClick:()=>(async()=>{try{var e,t,o,s;const a=null===(e=E.meta)||void 0===e?void 0:e.locked,r="/admin/forums/threads/".concat(C,a?"/unlock":"/lock"),n=await P.post(r);null!==(t=n.data)&&void 0!==t&&t.success||null!==(o=n.data)&&void 0!==o&&null!==(s=o.message)&&void 0!==s&&s.includes("successfully")?await ae():alert("Failed to update thread lock status")}catch(a){console.error("\u274c Failed to lock/unlock thread:",a),alert("Failed to update thread lock status")}})(),className:"px-3 py-1 text-xs rounded ".concat(null!==(f=E.meta)&&void 0!==f&&f.locked?"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300"," hover:opacity-80 transition-opacity"),children:null!==(w=E.meta)&&void 0!==w&&w.locked?"\ud83d\udd12 Unlock":"\ud83d\udd12 Lock"}),(0,c.jsx)("button",{onClick:()=>(async()=>{if(window.confirm("Are you sure you want to delete this entire thread? This action cannot be undone."))try{var e,t;Y(!0);const o=await P.delete("/user/forums/threads/".concat(C));200===o.status||!0===(null===(e=o.data)||void 0===e?void 0:e.success)||"true"===(null===(t=o.data)||void 0===t?void 0:t.success)?A&&A("forums"):alert("Failed to delete thread. Please try again.")}catch(a){var o,s;console.error("\u274c Failed to delete thread:",a),404===(null===(o=a.response)||void 0===o?void 0:o.status)?(alert("Thread not found or has already been deleted."),A&&A("forums")):403===(null===(s=a.response)||void 0===s?void 0:s.status)?alert("You do not have permission to delete this thread."):alert("Failed to delete thread. Please try again.")}finally{Y(!1)}})(),disabled:H,className:"px-3 py-1 text-xs rounded bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300 hover:bg-red-200 dark:hover:bg-red-900/50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:H?"\ud83d\uddd1\ufe0f Deleting...":"\ud83d\uddd1\ufe0f Delete Thread"})]})})]})})}),z.length>0&&(0,c.jsx)("div",{className:"space-y-4",children:z.map((e=>(0,c.jsx)("div",{className:"card p-6",children:le(e,!1,0)},e.id)))}),S&&!(null!==(k=E.meta)&&void 0!==k&&k.locked)&&!q&&(0,c.jsxs)("div",{className:"card p-6 mt-6",children:[(0,c.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Post Reply"}),(0,c.jsxs)("form",{onSubmit:de,children:[(0,c.jsx)(l.A,{value:R,onChange:L,placeholder:"Write your reply... (Type @ to mention teams and players)",rows:4,className:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white resize-none focus:ring-2 focus:ring-red-500 dark:focus:ring-red-400 focus:border-transparent"}),(0,c.jsxs)("div",{className:"flex justify-between items-center mt-3",children:[(0,c.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-500",children:"Use @ for users, @team: for teams, @player: for players"}),(0,c.jsx)("button",{type:"submit",disabled:!se(R).trim()||H,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:H?"Posting...":"Post Reply"})]})]})]}),!S&&!(null!==(j=E.meta)&&void 0!==j&&j.locked)&&(0,c.jsxs)("div",{className:"card p-6 mt-6 text-center",children:[(0,c.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Join the Discussion"}),(0,c.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Sign in to reply to this thread and join the conversation."}),(0,c.jsx)("button",{onClick:()=>window.dispatchEvent(new CustomEvent("mrvl-show-auth-modal")),className:"px-6 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"Sign In to Reply"})]}),(null===(N=E.meta)||void 0===N?void 0:N.locked)&&(0,c.jsxs)("div",{className:"card p-6 mt-6 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800",children:[(0,c.jsxs)("div",{className:"flex items-center space-x-2 text-red-800 dark:text-red-300",children:[(0,c.jsx)("span",{className:"text-lg",children:"\ud83d\udd12"}),(0,c.jsx)("span",{className:"font-medium",children:"This thread is locked"})]}),(0,c.jsx)("p",{className:"text-sm text-red-700 dark:text-red-400 mt-1",children:"No new replies can be posted to this thread."})]})]}):(0,c.jsxs)("div",{className:"card p-12 text-center",children:[(0,c.jsx)("div",{className:"text-4xl mb-4",children:"\u274c"}),(0,c.jsx)("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Thread Not Found"}),(0,c.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"The requested thread could not be found or has been deleted."}),(0,c.jsx)("button",{onClick:()=>A&&A("forums"),className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"Back to Forums"})]})}}}]);