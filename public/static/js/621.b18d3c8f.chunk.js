"use strict";(self.webpackChunkmrvl_frontend=self.webpackChunkmrvl_frontend||[]).push([[621],{3577:(e,a,t)=>{t.d(a,{Zw:()=>i,ii:()=>r,jz:()=>n,pq:()=>o,qZ:()=>l});const s={competitive:[{id:"krakoa",name:"Hellfire Gala: Krakoa",mode:"Domination",type:"competitive",icon:"\ud83d\udd25",season:2,description:"NEW Season 2 competitive map"},{id:"hells_heaven",name:"Hydra Charteris Base: Hell's Heaven",mode:"Domination",type:"competitive",icon:"\u2699\ufe0f",season:1,description:"Classic domination battleground"},{id:"birnin_tchalla",name:"Intergalactic Empire of Wakanda: Birnin T'Challa",mode:"Domination",type:"competitive",icon:"\ud83d\udc8e",season:1,description:"Wakandan capital warfare"},{id:"central_park",name:"Empire of Eternal Night: Central Park",mode:"Convoy",type:"competitive",icon:"\ud83c\udf03",season:1,description:"Payload escort through darkened NYC"}],all:[{name:"Hellfire Gala: Krakoa",mode:"Domination",status:"active",competitive:!0},{name:"Yggsgard: Royal Palace",mode:"Domination",status:"removed",season:2},{name:"Hydra Charteris Base: Hell's Heaven",mode:"Domination",status:"active",competitive:!0},{name:"Intergalactic Empire of Wakanda: Birnin T'Challa",mode:"Domination",status:"active",competitive:!0},{name:"Empire of Eternal Night: Central Park",mode:"Convoy",status:"active",competitive:!0},{name:"Tokyo 2099: Spider-Islands",mode:"Convoy",status:"active",competitive:!1},{name:"Yggsgard: Yggdrasill Path",mode:"Convoy",status:"active",competitive:!1},{name:"Empire of Eternal Night: Midtown",mode:"Convoy",status:"active",competitive:!1},{name:"Empire of Eternal Night: Sanctum Sanctorum",mode:"Convergence",status:"active",competitive:!1},{name:"Tokyo 2099: Shin-Shibuya",mode:"Convergence",status:"removed",season:2},{name:"Klyntar: Symbiotic Surface",mode:"Convergence",status:"active",competitive:!1},{name:"Intergalactic Empire of Wakanda: Hall of Djalia",mode:"Convergence",status:"active",competitive:!1}],casual:[{id:"royal_palace",name:"Yggsgard: Royal Palace",mode:"Domination",type:"casual",icon:"\ud83d\udc51",removed:"Season 2",description:"REMOVED from competitive Season 2"},{id:"spider_islands",name:"Tokyo 2099: Spider-Islands",mode:"Convoy",type:"casual",icon:"\ud83d\udd78\ufe0f",description:"Futuristic Tokyo payload escort"},{id:"yggdrasill_path",name:"Yggsgard: Yggdrasill Path",mode:"Convoy",type:"casual",icon:"\ud83c\udf33",description:"World tree convoy route"},{id:"midtown",name:"Empire of Eternal Night: Midtown",mode:"Convoy",type:"casual",icon:"\ud83c\udfe2",description:"Manhattan streets payload"},{id:"sanctum_sanctorum",name:"Empire of Eternal Night: Sanctum Sanctorum",mode:"Convergence",type:"casual",icon:"\ud83d\udd2e",description:"Mystical hybrid combat"},{id:"shin_shibuya",name:"Tokyo 2099: Shin-Shibuya",mode:"Convergence",type:"casual",icon:"\ud83d\uddfc",removed:"Season 2",description:"REMOVED from rotation Season 2"},{id:"symbiotic_surface",name:"Klyntar: Symbiotic Surface",mode:"Convergence",type:"casual",icon:"\ud83d\udda4",description:"Alien world convergence"},{id:"hall_of_djalia",name:"Intergalactic Empire of Wakanda: Hall of Djalia",mode:"Convergence",type:"casual",icon:"\u2728",description:"Ancestral plane hybrid battle"}]},r={Domination:{name:"Domination",icon:"\ud83c\udfaf",type:"Control Point",format:"Best of 3 rounds",timer:{preparation:30,captureRate:1.2,roundLimit:null},description:"Control single point, best of 3 rounds",overtime:"Triggered when contested near round end"},Convoy:{name:"Convoy",icon:"\ud83d\ude9b",type:"Escort",format:"2 rounds in Competitive (swap sides)",timer:{preparation:30,baseTime:300,checkpoint1:180,checkpoint2:90},description:"Escort payload through checkpoints",checkpoints:3},Convergence:{name:"Convergence",icon:"\ud83d\udd04",type:"Hybrid",format:"2 rounds in Competitive (swap sides)",timer:{preparation:30,capturePhase:240,escortPhase:90},description:"Capture point then escort payload",phases:["Capture","Escort"]}},o={Vanguard:["Captain America","Doctor Strange","Groot","Hulk","Magneto","Peni Parker","Thor","Venom","Emma Frost","Bruce Banner","Mr. Fantastic","TBD"],Duelist:["Black Panther","Black Widow","Hawkeye","Hela","Iron Man","Magik","Moon Knight","Namor","Psylocke","Punisher","Scarlet Witch","Spider-Man","Star-Lord","Storm","Wolverine","Winter Soldier","Iron Fist","Squirrel Girl","TBD"],Strategist:["Adam Warlock","Cloak & Dagger","Jeff the Land Shark","Loki","Luna Snow","Mantis","Rocket Raccoon","TBD"]},n=[{value:"BO1",label:"Best of 1",maps:1,winCondition:"First to 1",usage:["Open Qualifiers","Swiss Rounds","Quick Matches"]},{value:"BO3",label:"Best of 3",maps:3,winCondition:"First to 2",usage:["Group Stage","Regular Season","Upper Bracket"]},{value:"BO5",label:"Best of 5",maps:5,winCondition:"First to 3",usage:["Playoffs","Lower Bracket","Semifinals"]},{value:"BO7",label:"Best of 7",maps:7,winCondition:"First to 4",usage:["Championship Finals","Grand Finals","Major Finals"]},{value:"BO9",label:"Best of 9",maps:9,winCondition:"First to 5",usage:["World Championship","Season Finals","Special Events"]}],i=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";const t=[...s.competitive,...s.casual];let r=t;"all"!==a&&(r=t.filter((e=>e.mode===a))),r=r.filter((e=>!e.removed));const o=n.find((a=>a.value===e)),i=(null===o||void 0===o?void 0:o.maps)||1,l=r.filter((e=>"competitive"===e.type)),c=r.filter((e=>"casual"===e.type));let m=[];return m.push(...l),m.length<i&&m.push(...c.slice(0,i-m.length)),m.slice(0,i)},l=e=>{const a=n.find((a=>a.value===e)),t=(null===a||void 0===a?void 0:a.maps)||1,s=["Domination","Convoy","Domination","Convergence","Convoy"],r=[];for(let o=0;o<t;o++)r.push(s[o%s.length]);return r}},5621:(e,a,t)=>{t.r(a),t.d(a,{default:()=>h});var s=t(2555),r=t(9950),o=t(6479),n=t(6149),i=t(7453),l=t(9975),c=t(5150),m=t(3577),d=t(6225),p=t(7674),u=t(4414);const h=e=>{var a,t,h,y;let{isOpen:g,onClose:v,match:x,onUpdate:f}=e;const{isAuthenticated:S,user:b,isAdmin:k}=(0,c.As)(),_="https://staging.mrvl.net",j=localStorage.getItem("authToken"),P=S&&j&&b&&k(),[w,N]=(0,r.useState)((()=>{const e={};for(let a=1;a<=3;a++)e[a]={team1Score:0,team2Score:0,status:1===a?"active":"pending",winner:null,team1Players:[],team2Players:[]};return{team1Score:0,team2Score:0,team1SeriesScore:0,team2SeriesScore:0,status:"live",currentMap:1,totalMaps:3,matchTimer:"00:00",team1Players:[],team2Players:[],maps:e}})),[A,M]=(0,r.useState)(!0),[C,E]=(0,r.useState)(!1),[T,I]=(0,r.useState)((new Date).toLocaleTimeString()),[D,B]=(0,r.useState)("idle"),O=(0,r.useRef)(!1),F=(0,r.useRef)(null),R=(0,r.useRef)(w),L=(0,r.useRef)(!1);(0,r.useEffect)((()=>{R.current=w}),[w]),(0,r.useEffect)((()=>{if(null!==x&&void 0!==x&&x.id){L.current=!1,H();const e=p.A.subscribe(x.id,z);return()=>{O.current=!0,L.current=!1,e(),F.current&&clearTimeout(F.current)}}}),[null===x||void 0===x?void 0:x.id]);const H=async()=>{if(null!==x&&void 0!==x&&x.id){E(!0);try{const e=await fetch("".concat(_,"/api/matches/").concat(x.id),{headers:{Authorization:"Bearer ".concat(j),Accept:"application/json"}});if(e.ok){const a=await e.json();J(a)}}catch(e){console.error("Error loading match data:",e)}finally{E(!1)}}},J=e=>{var a,t,s,r,o,n,i,l;const c=[],m=[],p=parseInt(e.current_map||e.currentMap||e.current_map_number||1);let u;if(L.current){var h;const e=null===(h=R.current)||void 0===h?void 0:h.currentMap;u=e&&e>0?e:p}else u=p,L.current=!0;const y=e.maps_data||e.maps||[],g=Array.isArray(y)?y[u-1]:y[u],v=(null===g||void 0===g?void 0:g.team1_composition)||(null===g||void 0===g?void 0:g.team1_players)||e.team1_players||("string"===typeof e.team1_players?JSON.parse(e.team1_players):e.team1_players)||(null===(a=e.team1)||void 0===a?void 0:a.players)||[],x=(null===g||void 0===g?void 0:g.team2_composition)||(null===g||void 0===g?void 0:g.team2_players)||e.team2_players||("string"===typeof e.team2_players?JSON.parse(e.team2_players):e.team2_players)||(null===(t=e.team2)||void 0===t?void 0:t.players)||[],f=(null===(s=e.team1)||void 0===s?void 0:s.players)||[],S=(null===(r=e.team2)||void 0===r?void 0:r.players)||[];for(let w=0;w<6;w++){const e=v[w]||{},a=f[w]||{},t=(e.eliminations||0)+(e.assists||0),s=e.deaths>0?(t/e.deaths).toFixed(2):t.toFixed(2);c.push({id:e.player_id||e.id||a.id||"t1_p".concat(w),name:e.name||e.username||a.username||a.name||"Player ".concat(w+1),hero:e.hero||"",role:e.role||(e.hero?(0,d.ZZ)(e.hero):""),kills:e.kills||e.eliminations||0,deaths:e.deaths||0,assists:e.assists||0,damage:e.damage||0,healing:e.healing||0,blocked:e.blocked||e.damage_blocked||0,kda:e.kda||s,isAlive:void 0===e.isAlive||e.isAlive})}for(let w=0;w<6;w++){const e=x[w]||{},a=S[w]||{},t=(e.eliminations||0)+(e.assists||0),s=e.deaths>0?(t/e.deaths).toFixed(2):t.toFixed(2);m.push({id:e.player_id||e.id||a.id||"t2_p".concat(w),name:e.name||e.username||a.username||a.name||"Player ".concat(w+1),hero:e.hero||"",role:e.role||(e.hero?(0,d.ZZ)(e.hero):""),kills:e.kills||e.eliminations||0,deaths:e.deaths||0,assists:e.assists||0,damage:e.damage||0,healing:e.healing||0,blocked:e.blocked||e.damage_blocked||0,kda:e.kda||s,isAlive:void 0===e.isAlive||e.isAlive})}const b=e.maps_data||e.maps||[],k={},_=e.format||e.match_format||"BO3",j="BO3"===_?3:"BO5"===_?5:3,P=e.total_maps_played||j;if(Array.isArray(b)){b.forEach(((e,a)=>{const t=a+1,s=e.team1_composition||e.team1_players||[],r=e.team2_composition||e.team2_players||[];k[t]={team1Score:e.team1_score||0,team2Score:e.team2_score||0,status:e.status||"pending",winner:e.winner_id||null,mapName:e.map_name||"Map ".concat(t),mode:e.mode||"Push",team1Players:t===u?c:s,team2Players:t===u?m:r}}));for(let e=b.length+1;e<=P;e++)k[e]={team1Score:0,team2Score:0,status:"pending",winner:null,mapName:"Map ".concat(e),mode:"Push",team1Players:e===u?c:[],team2Players:e===u?m:[]}}else for(let d=1;d<=P;d++){var A,M,C,E,T,I,D,B;k[d]={team1Score:(null===(A=b[d])||void 0===A?void 0:A.team1_score)||0,team2Score:(null===(M=b[d])||void 0===M?void 0:M.team2_score)||0,status:(null===(C=b[d])||void 0===C?void 0:C.status)||(d===u?"active":d<u?"completed":"pending"),winner:(null===(E=b[d])||void 0===E?void 0:E.winner)||null,mapName:(null===(T=b[d])||void 0===T?void 0:T.map_name)||"Map ".concat(d),mode:(null===(I=b[d])||void 0===I?void 0:I.mode)||"Push",team1Players:d===u?c:(null===(D=b[d])||void 0===D?void 0:D.team1Players)||[],team2Players:d===u?m:(null===(B=b[d])||void 0===B?void 0:B.team2Players)||[]}}N({team1Score:(null===(o=k[u])||void 0===o?void 0:o.team1Score)||0,team2Score:(null===(n=k[u])||void 0===n?void 0:n.team2Score)||0,team1SeriesScore:e.series_score_team1||0,team2SeriesScore:e.series_score_team2||0,status:e.status||"live",team1Players:(null===(i=k[u])||void 0===i?void 0:i.team1Players)||c,team2Players:(null===(l=k[u])||void 0===l?void 0:l.team2Players)||m,currentMap:u,totalMaps:P,matchTimer:w.matchTimer||"00:00",maps:k})},z=(0,r.useCallback)((e=>{O.current||(J(e),I((new Date).toLocaleTimeString()),f&&f(e))}),[f]),G=(0,r.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(null===x||void 0===x||!x.id||!P)return;const a=R.current,t=(0,s.A)({},a.maps);t[a.currentMap]&&(t[a.currentMap].team1Players=a.team1Players,t[a.currentMap].team2Players=a.team2Players);const r=Object.keys(t).sort(((e,a)=>parseInt(e)-parseInt(a))).map((e=>(0,s.A)((0,s.A)({},t[e]),{},{map_number:parseInt(e),team1_score:t[e].team1Score,team2_score:t[e].team2Score,team1_composition:t[e].team1Players||[],team2_composition:t[e].team2Players||[]}))),o=(0,s.A)((0,s.A)({id:x.id,team1_score:a.maps[a.currentMap].team1Score,team2_score:a.maps[a.currentMap].team2Score,series_score_team1:a.team1SeriesScore,series_score_team2:a.team2SeriesScore},e&&{current_map:a.currentMap,isMapSwitch:!0}),{},{status:a.status,maps:r,team1_players:a.team1Players,team2_players:a.team2Players,total_maps:a.totalMaps});p.A.broadcastUpdate(x.id,o),B("saving"),F.current&&clearTimeout(F.current),F.current=setTimeout((async()=>{try{(await fetch("".concat(_,"/api/matches/").concat(x.id,"/live-update"),{method:"POST",headers:{Authorization:"Bearer ".concat(j),"Content-Type":"application/json"},body:JSON.stringify({type:"score-update",data:o,timestamp:(new Date).toISOString()})})).ok?(B("saved"),setTimeout((()=>B("idle")),2e3)):(console.error("Failed to save to server"),B("error"),setTimeout((()=>B("idle")),3e3))}catch(e){console.error("Error saving match data:",e),B("error"),setTimeout((()=>B("idle")),3e3)}}),500)}),[null===x||void 0===x?void 0:x.id,P,j]),W=(e,a)=>{N((t=>{const r=(0,s.A)({},t),o=(0,s.A)({},r.maps[r.currentMap]);return 1===e?o.team1Score=Math.max(0,o.team1Score+a):o.team2Score=Math.max(0,o.team2Score+a),r.maps[r.currentMap]=o,r.team1Score=o.team1Score,r.team2Score=o.team2Score,setTimeout((()=>G()),100),r}))},K=async(e,a,t)=>{console.log("updatePlayerHero called:",{team:e,playerIndex:a,hero:t});const r=(1===e?w.team1Players:w.team2Players)[a];console.log("Player data:",r),N((r=>{const o=(0,s.A)({},r),n=1===e?[...o.team1Players]:[...o.team2Players];return n[a]=(0,s.A)((0,s.A)({},n[a]),{},{hero:t,role:t?(0,d.ZZ)(t):""}),1===e?o.team1Players=n:o.team2Players=n,o.maps[o.currentMap]&&(o.maps[o.currentMap].team1Players=o.team1Players,o.maps[o.currentMap].team2Players=o.team2Players),o}));const o=(null===r||void 0===r?void 0:r.player_id)||(null===r||void 0===r?void 0:r.id);if(r&&o){console.log("Sending hero update to backend:",{player_id:o,hero:t,map_index:w.currentMap-1});try{(await fetch("".concat(_,"/api/matches/").concat(x.id,"/live-update"),{method:"POST",headers:{Authorization:"Bearer ".concat(j),"Content-Type":"application/json"},body:JSON.stringify({type:"hero-update",data:{map_index:w.currentMap-1,team:e,player_id:o,hero:t,role:t?(0,d.ZZ)(t):"",player_name:r.name},timestamp:(new Date).toISOString()})})).ok||console.error("Failed to update hero")}catch(n){console.error("Error updating hero:",n)}}},V=async(e,a,t,r)=>{console.log("updatePlayerStat called:",{team:e,playerIndex:a,stat:t,value:r});const o=(1===e?w.team1Players:w.team2Players)[a],n=Math.max(0,parseInt(r)||0);console.log("Player data:",o),N((r=>{const o=(0,s.A)({},r),i=1===e?[...o.team1Players]:[...o.team2Players];i[a]=(0,s.A)((0,s.A)({},i[a]),{},{[t]:n});const{kills:l,deaths:c,assists:m}=i[a];return i[a].kda=0===c?(l+m).toFixed(2):((l+m)/c).toFixed(2),1===e?o.team1Players=i:o.team2Players=i,o.maps[o.currentMap]&&(o.maps[o.currentMap].team1Players=o.team1Players,o.maps[o.currentMap].team2Players=o.team2Players),o}));const i=(null===o||void 0===o?void 0:o.player_id)||(null===o||void 0===o?void 0:o.id);if(o&&i){console.log("Sending stat update to backend:",{player_id:i,stat_type:t,value:n,map_index:w.currentMap-1});try{(await fetch("".concat(_,"/api/matches/").concat(x.id,"/live-update"),{method:"POST",headers:{Authorization:"Bearer ".concat(j),"Content-Type":"application/json"},body:JSON.stringify({type:"stats-update",data:{map_index:w.currentMap-1,team:e,player_id:i,stat_type:t,value:n,player_name:o.name},timestamp:(new Date).toISOString()})})).ok||console.error("Failed to update stat")}catch(l){console.error("Error updating stat:",l)}}};return g?(0,u.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,u.jsxs)("div",{className:"bg-gray-800 rounded-lg w-full max-w-6xl max-h-[90vh] overflow-y-auto",children:[(0,u.jsxs)("div",{className:"sticky top-0 bg-gray-800 border-b border-gray-700 p-4 z-10",children:[(0,u.jsxs)("div",{className:"flex justify-between items-center",children:[(0,u.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Live Scoring Panel"}),(0,u.jsx)("button",{onClick:v,className:"text-gray-400 hover:text-white",children:(0,u.jsx)(o.A,{size:24})})]}),(0,u.jsxs)("div",{className:"mt-2 text-sm text-gray-400 flex items-center gap-4",children:[(0,u.jsxs)("span",{children:["Last Update: ",T]}),(0,u.jsxs)("span",{children:["Status: ",w.status]}),(0,u.jsxs)("span",{className:"flex items-center gap-1 ".concat("saving"===D?"text-yellow-400":"saved"===D?"text-green-400":"error"===D?"text-red-400":"text-gray-400"),children:["saving"===D&&"\u23f3 Saving...","saved"===D&&"\u2713 Saved","error"===D&&"\u26a0 Save Failed","idle"===D&&""]})]})]}),(0,u.jsx)("div",{className:"p-4 border-b border-gray-700",children:(0,u.jsx)("div",{className:"flex gap-2 flex-wrap",children:Array.from({length:w.totalMaps},((e,a)=>a+1)).map((e=>{const a=w.maps&&w.maps[e]?w.maps[e]:{status:"pending",winner:null};return(0,u.jsxs)("button",{onClick:()=>(async e=>{null!==x&&void 0!==x&&x.id&&(console.log("Switching to map ".concat(e)),N((a=>{const t=(0,s.A)({},a);if(t.maps[t.currentMap]&&(t.maps[t.currentMap].team1Players=[...a.team1Players],t.maps[t.currentMap].team2Players=[...a.team2Players]),t.currentMap=e,t.maps&&t.maps[e]){if(t.team1Score=t.maps[e].team1Score||0,t.team2Score=t.maps[e].team2Score||0,t.team1Players=t.maps[e].team1Players||[],t.team2Players=t.maps[e].team2Players||[],0===t.team1Players.length)for(let e=0;e<6;e++)t.team1Players.push({id:"t1_p".concat(e),name:"Player ".concat(e+1),hero:"",role:"",kills:0,deaths:0,assists:0,damage:0,healing:0,blocked:0,kda:"0.00",isAlive:!0});if(0===t.team2Players.length)for(let e=0;e<6;e++)t.team2Players.push({id:"t2_p".concat(e),name:"Player ".concat(e+1),hero:"",role:"",kills:0,deaths:0,assists:0,damage:0,healing:0,blocked:0,kda:"0.00",isAlive:!0})}return t})),setTimeout((()=>G(!0)),100))})(e),className:"px-3 py-2 rounded text-sm font-medium transition-colors ".concat(w.currentMap===e?"bg-blue-600 text-white shadow-lg":"completed"===a.status?"bg-green-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:[(0,u.jsxs)("div",{className:"flex items-center gap-1",children:[a.mapName||"Map ".concat(e),a.winner&&(0,u.jsx)(n.A,{size:14,className:"text-yellow-400"})]}),"completed"===a.status&&(0,u.jsxs)("div",{className:"text-xs mt-1",children:[a.team1Score,"-",a.team2Score]})]},e)}))})}),(0,u.jsx)("div",{className:"p-4 bg-gray-750",children:(0,u.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,u.jsxs)("div",{className:"text-center",children:[(0,u.jsx)("h3",{className:"text-lg font-bold text-blue-400 mb-2",children:(null===x||void 0===x||null===(a=x.team1)||void 0===a?void 0:a.name)||"Team 1"}),(0,u.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,u.jsx)("button",{onClick:()=>W(1,-1),className:"px-3 py-1 bg-red-600 text-white rounded",children:"-"}),(0,u.jsx)("span",{className:"text-3xl font-bold text-white px-4",children:w.team1Score}),(0,u.jsx)("button",{onClick:()=>W(1,1),className:"px-3 py-1 bg-green-600 text-white rounded",children:"+"})]}),(0,u.jsxs)("div",{className:"mt-2",children:[(0,u.jsx)("span",{className:"text-sm text-gray-400",children:"Series: "}),(0,u.jsx)("span",{className:"text-xl font-bold text-white",children:w.team1SeriesScore})]})]}),(0,u.jsxs)("div",{className:"text-center",children:[(0,u.jsx)("div",{className:"mb-4",children:(0,u.jsxs)("span",{className:"text-2xl font-bold text-white",children:["Map ",w.currentMap," of ",w.totalMaps]})}),(0,u.jsx)("button",{onClick:()=>{var e,a;const t="".concat(w.team1Score," - ").concat(w.team2Score),r=w.team1Score>w.team2Score?null===x||void 0===x||null===(e=x.team1)||void 0===e?void 0:e.name:w.team2Score>w.team1Score?null===x||void 0===x||null===(a=x.team2)||void 0===a?void 0:a.name:"Draw";window.confirm("End Map ".concat(w.currentMap," with score ").concat(t,"?\nWinner: ").concat(r,"\n\nThis action cannot be undone."))&&N((e=>{const a=(0,s.A)({},e),t=a.maps[a.currentMap];if(t.team1Score>t.team2Score?(t.winner="team1",a.team1SeriesScore++):t.team2Score>t.team1Score&&(t.winner="team2",a.team2SeriesScore++),t.status="completed",a.currentMap<a.totalMaps){a.currentMap++;const e=a.maps[a.currentMap];e.status="active",a.team1Score=e.team1Score,a.team2Score=e.team2Score}return setTimeout((()=>G(!0)),100),a}))},className:"px-6 py-2 bg-orange-600 text-white rounded hover:bg-orange-700",children:"End Current Map"})]}),(0,u.jsxs)("div",{className:"text-center",children:[(0,u.jsx)("h3",{className:"text-lg font-bold text-red-400 mb-2",children:(null===x||void 0===x||null===(t=x.team2)||void 0===t?void 0:t.name)||"Team 2"}),(0,u.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,u.jsx)("button",{onClick:()=>W(2,-1),className:"px-3 py-1 bg-red-600 text-white rounded",children:"-"}),(0,u.jsx)("span",{className:"text-3xl font-bold text-white px-4",children:w.team2Score}),(0,u.jsx)("button",{onClick:()=>W(2,1),className:"px-3 py-1 bg-green-600 text-white rounded",children:"+"})]}),(0,u.jsxs)("div",{className:"mt-2",children:[(0,u.jsx)("span",{className:"text-sm text-gray-400",children:"Series: "}),(0,u.jsx)("span",{className:"text-xl font-bold text-white",children:w.team2SeriesScore})]})]})]})}),(0,u.jsxs)("div",{className:"p-4",children:[(0,u.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,u.jsxs)("button",{onClick:()=>M(!A),className:"flex items-center gap-2 text-white text-lg font-bold",children:[(0,u.jsx)(i.A,{className:"transform transition-transform ".concat(A?"rotate-180":"")}),"Player Statistics - Map ",w.currentMap]}),w.currentMap>1&&(0,u.jsxs)("button",{onClick:()=>{w.currentMap<=1||N((e=>{const a=(0,s.A)({},e),t=a.maps[a.currentMap-1];return a.team1Players=(t.team1Players||[]).map((e=>(0,s.A)((0,s.A)({},e),{},{kills:0,deaths:0,assists:0,damage:0,healing:0,blocked:0,kda:"0.00",isAlive:!0}))),a.team2Players=(t.team2Players||[]).map((e=>(0,s.A)((0,s.A)({},e),{},{kills:0,deaths:0,assists:0,damage:0,healing:0,blocked:0,kda:"0.00",isAlive:!0}))),a.maps[a.currentMap].team1Players=a.team1Players,a.maps[a.currentMap].team2Players=a.team2Players,setTimeout((()=>G()),100),a}))},className:"px-4 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700",children:["Copy Lineup from Map ",w.currentMap-1]})]}),A&&(0,u.jsxs)("div",{className:"space-y-6",children:[(0,u.jsxs)("div",{className:"bg-blue-900/20 rounded-lg p-4",children:[(0,u.jsxs)("h4",{className:"text-blue-400 font-bold mb-4 flex items-center gap-2",children:[(0,u.jsx)(l.A,{size:18}),(null===x||void 0===x||null===(h=x.team1)||void 0===h?void 0:h.name)||"Team 1"," Players"]}),(0,u.jsx)("div",{className:"space-y-3",children:w.team1Players.map(((e,a)=>(0,u.jsxs)("div",{className:"bg-gray-700/50 rounded-lg p-3 border border-gray-600",children:[(0,u.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,u.jsxs)("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-gray-600 flex-shrink-0",children:[e.hero&&(0,u.jsx)("img",{src:(0,d.JH)(e.hero),alt:e.hero,className:"w-full h-full object-cover",onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="flex"}}),(0,u.jsx)("div",{className:"w-full h-full bg-gray-600 flex items-center justify-center text-gray-400 text-xs",style:{display:e.hero?"none":"flex"},children:e.hero?e.hero.charAt(0):"?"})]}),(0,u.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,u.jsx)("div",{className:"font-medium text-white truncate",children:e.name}),(0,u.jsx)("div",{className:"text-sm text-gray-400",children:e.role||"No Role"})]}),(0,u.jsxs)("select",{value:e.hero,onChange:e=>K(1,a,e.target.value),className:"bg-gray-600 text-white px-3 py-1 rounded text-sm",children:[(0,u.jsx)("option",{value:"",children:"Select Hero"}),(0,u.jsx)("optgroup",{label:"Vanguard",children:m.pq.Vanguard.filter((e=>"TBD"!==e)).map((e=>(0,u.jsx)("option",{value:e,children:e},e)))}),(0,u.jsx)("optgroup",{label:"Duelist",children:m.pq.Duelist.filter((e=>"TBD"!==e)).map((e=>(0,u.jsx)("option",{value:e,children:e},e)))}),(0,u.jsx)("optgroup",{label:"Strategist",children:m.pq.Strategist.filter((e=>"TBD"!==e)).map((e=>(0,u.jsx)("option",{value:e,children:e},e)))})]})]}),(0,u.jsx)("div",{className:"grid grid-cols-6 gap-2",children:[{key:"kills",label:"K",color:"text-green-400"},{key:"deaths",label:"D",color:"text-red-400"},{key:"assists",label:"A",color:"text-blue-400"},{key:"damage",label:"DMG",color:"text-orange-400"},{key:"healing",label:"H",color:"text-green-300"},{key:"blocked",label:"B",color:"text-purple-400"}].map((t=>(0,u.jsxs)("div",{className:"text-center",children:[(0,u.jsx)("label",{className:"text-xs font-medium ".concat(t.color),children:t.label}),(0,u.jsx)("input",{type:"number",value:e[t.key],onChange:e=>{const s=Math.max(0,parseInt(e.target.value)||0);V(1,a,t.key,s)},className:"w-full bg-gray-600 text-white px-1 py-1 rounded text-sm text-center",min:"0",onKeyDown:e=>{"-"!==e.key&&"e"!==e.key||e.preventDefault()}})]},t.key)))})]},e.id)))})]}),(0,u.jsxs)("div",{className:"bg-red-900/20 rounded-lg p-4",children:[(0,u.jsxs)("h4",{className:"text-red-400 font-bold mb-4 flex items-center gap-2",children:[(0,u.jsx)(l.A,{size:18}),(null===x||void 0===x||null===(y=x.team2)||void 0===y?void 0:y.name)||"Team 2"," Players"]}),(0,u.jsx)("div",{className:"space-y-3",children:w.team2Players.map(((e,a)=>(0,u.jsxs)("div",{className:"bg-gray-700/50 rounded-lg p-3 border border-gray-600",children:[(0,u.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,u.jsxs)("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-gray-600 flex-shrink-0",children:[e.hero&&(0,u.jsx)("img",{src:(0,d.JH)(e.hero),alt:e.hero,className:"w-full h-full object-cover",onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="flex"}}),(0,u.jsx)("div",{className:"w-full h-full bg-gray-600 flex items-center justify-center text-gray-400 text-xs",style:{display:e.hero?"none":"flex"},children:e.hero?e.hero.charAt(0):"?"})]}),(0,u.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,u.jsx)("div",{className:"font-medium text-white truncate",children:e.name}),(0,u.jsx)("div",{className:"text-sm text-gray-400",children:e.role||"No Role"})]}),(0,u.jsxs)("select",{value:e.hero,onChange:e=>K(2,a,e.target.value),className:"bg-gray-600 text-white px-3 py-1 rounded text-sm",children:[(0,u.jsx)("option",{value:"",children:"Select Hero"}),(0,u.jsx)("optgroup",{label:"Vanguard",children:m.pq.Vanguard.filter((e=>"TBD"!==e)).map((e=>(0,u.jsx)("option",{value:e,children:e},e)))}),(0,u.jsx)("optgroup",{label:"Duelist",children:m.pq.Duelist.filter((e=>"TBD"!==e)).map((e=>(0,u.jsx)("option",{value:e,children:e},e)))}),(0,u.jsx)("optgroup",{label:"Strategist",children:m.pq.Strategist.filter((e=>"TBD"!==e)).map((e=>(0,u.jsx)("option",{value:e,children:e},e)))})]})]}),(0,u.jsx)("div",{className:"grid grid-cols-6 gap-2",children:[{key:"kills",label:"K",color:"text-green-400"},{key:"deaths",label:"D",color:"text-red-400"},{key:"assists",label:"A",color:"text-blue-400"},{key:"damage",label:"DMG",color:"text-orange-400"},{key:"healing",label:"H",color:"text-green-300"},{key:"blocked",label:"B",color:"text-purple-400"}].map((t=>(0,u.jsxs)("div",{className:"text-center",children:[(0,u.jsx)("label",{className:"text-xs font-medium ".concat(t.color),children:t.label}),(0,u.jsx)("input",{type:"number",value:e[t.key],onChange:e=>{const s=Math.max(0,parseInt(e.target.value)||0);V(2,a,t.key,s)},className:"w-full bg-gray-600 text-white px-1 py-1 rounded text-sm text-center",min:"0",onKeyDown:e=>{"-"!==e.key&&"e"!==e.key||e.preventDefault()}})]},t.key)))})]},e.id)))})]})]})]})]})}):null}},7674:(e,a,t)=>{t.d(a,{A:()=>r});var s=t(2555);const r=new class{constructor(){this.listeners=new Map,this.pollingIntervals=new Map,this.STORAGE_KEY_PREFIX="mrvl_live_match_",this.POLLING_INTERVAL=2e3,this.API_BASE="https://staging.mrvl.net",this.handleStorageChange=this.handleStorageChange.bind(this),"undefined"!==typeof window&&window.addEventListener("storage",this.handleStorageChange),console.log("\u26a1 LiveScoreSync initialized - Immediate updates ready")}subscribe(e,a){const t="match_".concat(e);return this.listeners.has(t)||this.listeners.set(t,new Set),this.listeners.get(t).add(a),this.startPolling(e),()=>{this.unsubscribe(e,a)}}unsubscribe(e,a){const t="match_".concat(e);this.listeners.has(t)&&(this.listeners.get(t).delete(a),0===this.listeners.get(t).size&&(this.stopPolling(e),this.listeners.delete(t)))}broadcastUpdate(e,a){const t="".concat(this.STORAGE_KEY_PREFIX).concat(e),r=(0,s.A)((0,s.A)({},a),{},{timestamp:Date.now(),source:"admin_panel"});try{localStorage.setItem(t,JSON.stringify(r)),this.notifyListeners(e,r),console.log("\ud83d\udce1 Broadcasting immediate update for match ".concat(e))}catch(o){console.error("Failed to broadcast update:",o)}}handleStorageChange(e){if(!e.key||!e.key.startsWith(this.STORAGE_KEY_PREFIX))return;const a=e.key.replace(this.STORAGE_KEY_PREFIX,"");if(e.newValue)try{const t=JSON.parse(e.newValue);this.notifyListeners(a,t),console.log("\ud83d\udce8 Immediate update received for match ".concat(a))}catch(t){console.error("Failed to parse storage update:",t)}}startPolling(e){this.stopPolling(e);const a=setInterval((async()=>{try{const a=await fetch("".concat(this.API_BASE,"/api/matches/").concat(e),{headers:{Accept:"application/json",Authorization:"Bearer ".concat(localStorage.getItem("authToken")||"")}});if(a.ok){const t=await a.json(),r="".concat(this.STORAGE_KEY_PREFIX).concat(e),o=localStorage.getItem(r),n=o?JSON.parse(o):null;if(!n||this.hasChanges(t,n)){const a=(0,s.A)((0,s.A)({},t),{},{timestamp:Date.now(),source:"polling"});localStorage.setItem(r,JSON.stringify(a)),this.notifyListeners(e,a),console.log("\ud83d\udd04 Polling update applied for match ".concat(e))}}}catch(a){"AbortError"!==a.name&&console.error("Polling error for match ".concat(e,":"),a)}}),this.POLLING_INTERVAL);this.pollingIntervals.set(e,a),console.log("\u26a1 Started polling for match ".concat(e," (2s intervals)"))}stopPolling(e){this.pollingIntervals.has(e)&&(clearInterval(this.pollingIntervals.get(e)),this.pollingIntervals.delete(e),console.log("\u23f9\ufe0f Stopped polling for match ".concat(e)))}hasChanges(e,a){const t=e.data||e,s=a.data||a,r=["team1_score","team2_score","status","current_map","series_score_team1","series_score_team2","current_map_number"];for(const o of r)if(t[o]!==s[o])return!0;if(JSON.stringify(t.maps||e.maps||[])!==JSON.stringify(s.maps||a.maps||[]))return!0;return JSON.stringify(t.team1_players||[])+JSON.stringify(t.team2_players||[])!==JSON.stringify(s.team1_players||[])+JSON.stringify(s.team2_players||[])}notifyListeners(e,a){const t="match_".concat(e);this.listeners.has(t)&&this.listeners.get(t).forEach((e=>{try{e(a)}catch(t){console.error("Error in listener callback:",t)}}))}async updateMatchScore(e,a,t){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=localStorage.getItem("authToken");try{const o={team1_score:a,team2_score:t};null!==s&&(o.current_map=s);const n=await fetch("".concat(this.API_BASE,"/api/matches/").concat(e,"/live-score"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r),Accept:"application/json"},body:JSON.stringify(o)});if(n.ok){const a=await n.json();return this.broadcastUpdate(e,a),console.log("\u2705 Score updated immediately for match ".concat(e)),a}}catch(o){console.error("Failed to update match score:",o)}return null}destroy(){"undefined"!==typeof window&&window.removeEventListener("storage",this.handleStorageChange),this.pollingIntervals.forEach((e=>clearInterval(e))),this.pollingIntervals.clear(),this.listeners.clear(),console.log("\ud83e\uddf9 LiveScoreSync destroyed")}}}}]);